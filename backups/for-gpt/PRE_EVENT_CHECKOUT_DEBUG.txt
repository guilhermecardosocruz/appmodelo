
===== app/(app)/eventos/[id]/PreEventClient.tsx =====
1 "use client";
2 
3 import { useEffect, useState } from "react";
4 import Link from "next/link";
5 import { useParams } from "next/navigation";
6 
7 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
8 
9 type Event = {
10   id: string;
11   name: string;
12   type: EventType;
13   description?: string | null;
14   location?: string | null;
15   eventDate?: string | null;
16   ticketPrice?: string | null;
17   paymentLink?: string | null;
18   salesStart?: string | null;
19   salesEnd?: string | null;
20 };
21 
22 export default function PreEventClient() {
23   const params = useParams() as { id?: string };
24   const eventId = String(params?.id ?? "").trim();
25 
26   const [loading, setLoading] = useState(true);
27   const [saving, setSaving] = useState(false);
28 
29   const [error, setError] = useState<string | null>(null);
30   const [success, setSuccess] = useState<string | null>(null);
31 
32   // Campos do formulário
33   const [name, setName] = useState("");
34   const [eventDate, setEventDate] = useState(""); // "YYYY-MM-DD"
35   const [location, setLocation] = useState("");
36   const [description, setDescription] = useState("");
37   const [ticketPrice, setTicketPrice] = useState("");
38   const [paymentLink, setPaymentLink] = useState("");
39   const [salesStart, setSalesStart] = useState("");
40   const [salesEnd, setSalesEnd] = useState("");
41 
42   useEffect(() => {
43     let active = true;
44 
45     async function load() {
46       try {
47         setLoading(true);
48         setError(null);
49         setSuccess(null);
50 
51         if (!eventId) {
52           setError("Evento não encontrado.");
53           return;
54         }
55 
56         const res = await fetch(`/api/events/${eventId}`);
57         if (!res.ok) {
58           const data = await res.json().catch(() => null);
59           if (!active) return;
60           setError(data?.error ?? "Erro ao carregar evento.");
61           return;
62         }
63 
64         const found = (await res.json()) as Event;
65         if (!active) return;
66 
67         setName(found.name ?? "");
68         setDescription(found.description ?? "");
69         setLocation(found.location ?? "");
70         setTicketPrice(found.ticketPrice ?? "");
71         setPaymentLink(found.paymentLink ?? "");
72 
73         if (found.eventDate) {
74           setEventDate(found.eventDate.slice(0, 10));
75         } else {
76           setEventDate("");
77         }
78 
79         if (found.salesStart) {
80           setSalesStart(found.salesStart.slice(0, 10));
81         } else {
82           setSalesStart("");
83         }
84 
85         if (found.salesEnd) {
86           setSalesEnd(found.salesEnd.slice(0, 10));
87         } else {
88           setSalesEnd("");
89         }
90       } catch (err) {
91         console.error("[PreEventClient] Erro no fetch:", err);
92         if (!active) return;
93         setError("Erro inesperado ao carregar evento.");
94       } finally {
95         if (!active) return;
96         setLoading(false);
97       }
98     }
99 
100     load();
101 
102     return () => {
103       active = false;
104     };
105   }, [eventId]);
106 
107   async function handleSave(e: React.FormEvent) {
108     e.preventDefault();
109     if (!eventId) {
110       setError("Evento não encontrado.");
111       return;
112     }
113 
114     if (!name.trim()) {
115       setError("O nome do evento não pode ficar vazio.");
116       setSuccess(null);
117       return;
118     }
119 
120     try {
121       setSaving(true);
122       setError(null);
123       setSuccess(null);
124 
125       const res = await fetch("/api/events", {
126         method: "PATCH",
127         headers: {
128           "Content-Type": "application/json",
129         },
130         body: JSON.stringify({
131           id: eventId,
132           name: name.trim(),
133           description: description.trim() || null,
134           location: location.trim() || null,
135           ticketPrice: ticketPrice.trim() || null,
136           paymentLink: paymentLink.trim() || null,
137           eventDate: eventDate || null,
138           salesStart: salesStart || null,
139           salesEnd: salesEnd || null,
140         }),
141       });
142 
143       if (!res.ok) {
144         const data = await res.json().catch(() => null);
145         setError(data?.error ?? "Erro ao salvar alterações.");
146         return;
147       }
148 
149       setSuccess("Alterações salvas com sucesso.");
150     } catch (err) {
151       console.error("[PreEventClient] Erro ao salvar:", err);
152       setError("Erro inesperado ao salvar alterações.");
153     } finally {
154       setSaving(false);
155     }
156   }
157 
158   const trimmedLocation = location.trim();
159   const hasLocation = trimmedLocation.length > 0;
160 
161   const googleMapsUrl = hasLocation
162     ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
163         trimmedLocation,
164       )}`
165     : null;
166 
167   const wazeUrl = hasLocation
168     ? `https://waze.com/ul?q=${encodeURIComponent(
169         trimmedLocation,
170       )}&navigate=yes`
171     : null;
172 
173   return (
174     <div className="min-h-screen bg-slate-950 text-slate-50 flex flex-col">
175       <header className="flex items-center justify-between px-6 py-4 border-b border-slate-800">
176         <Link
177           href="/dashboard/"
178           className="text-xs font-medium text-slate-300 hover:text-slate-100"
179         >
180           ← Voltar
181         </Link>
182 
183         <span className="inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-[11px] font-medium uppercase tracking-wide text-slate-300 border border-slate-700">
184           Evento pré pago
185         </span>
186       </header>
187 
188       <main className="flex-1 px-4 py-6 sm:px-6 lg:px-8 max-w-3xl w-full mx-auto flex flex-col gap-4">
189         {loading && (
190           <p className="text-sm text-slate-300">Carregando evento...</p>
191         )}
192 
193         {!loading && error && (
194           <p className="text-sm text-red-400">{error}</p>
195         )}
196 
197         {!loading && !error && (
198           <form
199             onSubmit={handleSave}
200             className="flex flex-col gap-4 rounded-2xl border border-slate-800 bg-slate-900/70 p-4 sm:p-6"
201           >
202             <h1 className="text-lg sm:text-xl font-semibold text-slate-50">
203               Configurações do evento pré pago
204             </h1>
205 
206             {success && (
207               <p className="text-xs text-emerald-400">
208                 {success}
209               </p>
210             )}
211 
212             {/* Nome */}
213             <div className="flex flex-col gap-1">
214               <label className="text-xs font-medium text-slate-300">
215                 Nome do evento
216               </label>
217               <input
218                 type="text"
219                 value={name}
220                 onChange={(e) => setName(e.target.value)}
221                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
222                 placeholder="Digite o nome do evento"
223               />
224             </div>
225 
226             {/* Data do evento */}
227             <div className="flex flex-col gap-1">
228               <label className="text-xs font-medium text-slate-300">
229                 Data do evento
230               </label>
231               <input
232                 type="date"
233                 value={eventDate}
234                 onChange={(e) => setEventDate(e.target.value)}
235                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
236               />
237               <p className="text-[10px] text-slate-500">
238                 Essa data é salva junto com o evento e pode aparecer nos convites.
239               </p>
240             </div>
241 
242             {/* Período de vendas */}
243             <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
244               <div className="flex flex-col gap-1">
245                 <label className="text-xs font-medium text-slate-300">
246                   Início das vendas
247                 </label>
248                 <input
249                   type="date"
250                   value={salesStart}
251                   onChange={(e) => setSalesStart(e.target.value)}
252                   className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
253                 />
254                 <p className="text-[10px] text-slate-500">
255                   Data a partir da qual você considera as vendas abertas.
256                 </p>
257               </div>
258 
259               <div className="flex flex-col gap-1">
260                 <label className="text-xs font-medium text-slate-300">
261                   Fim das vendas
262                 </label>
263                 <input
264                   type="date"
265                   value={salesEnd}
266                   onChange={(e) => setSalesEnd(e.target.value)}
267                   className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
268                 />
269                 <p className="text-[10px] text-slate-500">
270                   Data limite para a compra de ingressos (opcional).
271                 </p>
272               </div>
273             </div>
274 
275             {/* Local do evento */}
276             <div className="flex flex-col gap-1">
277               <label className="text-xs font-medium text-slate-300">
278                 Local do evento
279               </label>
280               <input
281                 type="text"
282                 value={location}
283                 onChange={(e) => setLocation(e.target.value)}
284                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
285                 placeholder="Ex.: Rua Nome da Rua, 123 - Bairro, Cidade - UF"
286               />
287               <p className="text-[10px] text-slate-500">
288                 Formato sugerido: "Rua Nome da Rua, 123 - Bairro, Cidade - UF".
289                 Ex.: "Rua Joaquim Nabuco, 100 - Centro, Criciúma - SC".
290               </p>
291               <p className="text-[10px] text-slate-500">
292                 Esse endereço será usado para gerar atalhos para Google Maps e Waze.
293               </p>
294             </div>
295 
296             {/* Atalhos de mapa (se tiver local) */}
297             {hasLocation && (
298               <div className="flex flex-col gap-2 rounded-xl border border-slate-800 bg-slate-950/60 p-3">
299                 <span className="text-xs font-medium text-slate-300">
300                   Como chegar ao local
301                 </span>
302                 <p className="text-[11px] text-slate-500">
303                   Use os atalhos abaixo para abrir o endereço direto no aplicativo de mapas.
304                 </p>
305 
306                 <div className="flex flex-wrap gap-2 mt-1">
307                   {googleMapsUrl && (
308                     <a
309                       href={googleMapsUrl}
310                       target="_blank"
311                       rel="noopener noreferrer"
312                       className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
313                     >
314                       Abrir no Google Maps
315                     </a>
316                   )}
317 
318                   {wazeUrl && (
319                     <a
320                       href={wazeUrl}
321                       target="_blank"
322                       rel="noopener noreferrer"
323                       className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
324                     >
325                       Abrir no Waze
326                     </a>
327                   )}
328                 </div>
329               </div>
330             )}
331 
332             {/* Valor do ingresso */}
333             <div className="flex flex-col gap-1">
334               <label className="text-xs font-medium text-slate-300">
335                 Valor do ingresso
336               </label>
337               <input
338                 type="text"
339                 value={ticketPrice}
340                 onChange={(e) => setTicketPrice(e.target.value)}
341                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
342                 placeholder='Ex.: "R$ 50,00" ou "R$ 30,00 meia, R$ 60,00 inteira"'
343               />
344               <p className="text-[10px] text-slate-500">
345                 Campo livre para você descrever valores (inteira, meia, lotes, etc).
346               </p>
347             </div>
348 
349             {/* Link de pagamento */}
350             <div className="flex flex-col gap-1">
351               <label className="text-xs font-medium text-slate-300">
352                 Link para pagamento / checkout
353               </label>
354               <input
355                 type="url"
356                 value={paymentLink}
357                 onChange={(e) => setPaymentLink(e.target.value)}
358                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
359                 placeholder="Cole aqui o link do checkout (ex.: plataforma de pagamentos, link do PIX, etc.)"
360               />
361               <p className="text-[10px] text-slate-500">
362                 Esse link poderá ser exibido nas páginas de convite ou enviado diretamente aos convidados.
363               </p>
364             </div>
365 
366             {/* Descrição */}
367             <div className="flex flex-col gap-1">
368               <label className="text-xs font-medium text-slate-300">
369                 Descrição do evento
370               </label>
371               <textarea
372                 value={description}
373                 onChange={(e) => setDescription(e.target.value)}
374                 rows={4}
375                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 resize-y"
376                 placeholder="Detalhe regras de pagamento, política de reembolso, lotes, etc."
377               />
378             </div>
379 
380             <div className="flex justify-end">
381               <button
382                 type="submit"
383                 disabled={saving}
384                 className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
385               >
386                 {saving ? "Salvando..." : "Salvar alterações"}
387               </button>
388             </div>
389           </form>
390         )}
391       </main>
392     </div>
393   );
394 }

===== app/api/events/[id]/route.ts =====
1 import { NextRequest, NextResponse } from "next/server";
2 import { prisma } from "@/lib/prisma";
3 
4 export async function GET(_request: NextRequest, context: any) {
5   try {
6     let rawParams = context?.params as any;
7 
8     // Se o Next resolver params como Promise, tratamos isso
9     if (rawParams && typeof rawParams.then === "function") {
10       rawParams = await rawParams;
11     }
12 
13     const id = String(rawParams?.id ?? "").trim();
14     console.log("[GET /api/events/[id]] params:", rawParams, "id:", id);
15 
16     if (!id) {
17       return NextResponse.json(
18         { error: "ID do evento é obrigatório." },
19         { status: 400 }
20       );
21     }
22 
23     const event = await prisma.event.findUnique({
24       where: { id },
25     });
26 
27     if (!event) {
28       return NextResponse.json(
29         { error: "Evento não encontrado." },
30         { status: 404 }
31       );
32     }
33 
34     return NextResponse.json(event, { status: 200 });
35   } catch (err) {
36     console.error("Erro ao buscar evento por ID:", err);
37     return NextResponse.json(
38       { error: "Erro ao buscar evento." },
39       { status: 500 }
40     );
41   }
42 }

===== app/api/events/route.ts =====
1 import { NextRequest, NextResponse } from "next/server";
2 import { prisma } from "@/lib/prisma";
3 
4 const VALID_TYPES = ["PRE_PAGO", "POS_PAGO", "FREE"] as const;
5 type EventType = (typeof VALID_TYPES)[number];
6 
7 // GET /api/events - lista todos os eventos
8 export async function GET(_request: NextRequest) {
9   const events = await prisma.event.findMany({
10     orderBy: { createdAt: "desc" },
11   });
12 
13   return NextResponse.json(events, { status: 200 });
14 }
15 
16 // POST /api/events - cria um novo evento
17 export async function POST(request: NextRequest) {
18   try {
19     const body = await request.json();
20     const name = String(body.name ?? "").trim();
21     const type = String(body.type ?? "").toUpperCase() as EventType;
22 
23     if (!name) {
24       return NextResponse.json(
25         { error: "Nome do evento é obrigatório." },
26         { status: 400 }
27       );
28     }
29 
30     if (!VALID_TYPES.includes(type)) {
31       return NextResponse.json(
32         { error: "Tipo de evento inválido." },
33         { status: 400 }
34       );
35     }
36 
37     const event = await prisma.event.create({
38       data: {
39         name,
40         type,
41       },
42     });
43 
44     return NextResponse.json(event, { status: 201 });
45   } catch (err) {
46     console.error("Erro ao criar evento:", err);
47     return NextResponse.json(
48       { error: "Erro ao criar evento." },
49       { status: 500 }
50     );
51   }
52 }
53 
54 // PATCH /api/events - atualiza um evento existente (id no corpo)
55 export async function PATCH(request: NextRequest) {
56   try {
57     const body = await request.json();
58     const id = String(body.id ?? "").trim();
59 
60     if (!id) {
61       return NextResponse.json(
62         { error: "ID do evento é obrigatório para atualizar." },
63         { status: 400 }
64       );
65     }
66 
67     const data: {
68       name?: string;
69       description?: string | null;
70       location?: string | null;
71       inviteSlug?: string | null;
72       eventDate?: Date | null;
73       ticketPrice?: string | null;
74       paymentLink?: string | null;
75       salesStart?: Date | null;
76       salesEnd?: Date | null;
77     } = {};
78 
79     if (typeof body.name === "string") {
80       const name = body.name.trim();
81       if (!name) {
82         return NextResponse.json(
83           { error: "Nome do evento não pode ser vazio." },
84           { status: 400 }
85         );
86       }
87       data.name = name;
88     }
89 
90     if (typeof body.description === "string" || body.description === null) {
91       data.description = body.description;
92     }
93 
94     if (typeof body.location === "string" || body.location === null) {
95       data.location = body.location;
96     }
97 
98     if (typeof body.inviteSlug === "string" || body.inviteSlug === null) {
99       data.inviteSlug = body.inviteSlug;
100     }
101 
102     if (typeof body.ticketPrice === "string" || body.ticketPrice === null) {
103       data.ticketPrice = body.ticketPrice;
104     }
105 
106     if (typeof body.paymentLink === "string" || body.paymentLink === null) {
107       data.paymentLink = body.paymentLink;
108     }
109 
110     // Trata eventDate vindo da tela (string "YYYY-MM-DD" ou ISO ou null)
111     if (typeof body.eventDate === "string" || body.eventDate === null) {
112       if (!body.eventDate) {
113         data.eventDate = null;
114       } else {
115         const d = new Date(body.eventDate);
116         if (Number.isNaN(d.getTime())) {
117           return NextResponse.json(
118             { error: "Data do evento inválida." },
119             { status: 400 }
120           );
121         }
122         data.eventDate = d;
123       }
124     }
125 
126     // Trata salesStart
127     if (typeof body.salesStart === "string" || body.salesStart === null) {
128       if (!body.salesStart) {
129         data.salesStart = null;
130       } else {
131         const d = new Date(body.salesStart);
132         if (Number.isNaN(d.getTime())) {
133           return NextResponse.json(
134             { error: "Data de início das vendas inválida." },
135             { status: 400 }
136           );
137         }
138         data.salesStart = d;
139       }
140     }
141 
142     // Trata salesEnd
143     if (typeof body.salesEnd === "string" || body.salesEnd === null) {
144       if (!body.salesEnd) {
145         data.salesEnd = null;
146       } else {
147         const d = new Date(body.salesEnd);
148         if (Number.isNaN(d.getTime())) {
149           return NextResponse.json(
150             { error: "Data de fim das vendas inválida." },
151             { status: 400 }
152           );
153         }
154         data.salesEnd = d;
155       }
156     }
157 
158     if (Object.keys(data).length === 0) {
159       return NextResponse.json(
160         { error: "Nenhum campo para atualizar." },
161         { status: 400 }
162       );
163     }
164 
165     const updated = await prisma.event.update({
166       where: { id },
167       data,
168     });
169 
170     return NextResponse.json(updated, { status: 200 });
171   } catch (err) {
172     console.error("Erro ao atualizar evento:", err);
173     return NextResponse.json(
174       { error: "Erro ao atualizar evento." },
175       { status: 500 }
176     );
177   }
178 }
179 
180 // DELETE /api/events - exclui um evento (id no corpo)
181 export async function DELETE(request: NextRequest) {
182   try {
183     const body = await request.json();
184     const id = String(body.id ?? "").trim();
185 
186     if (!id) {
187       return NextResponse.json(
188         { error: "ID do evento é obrigatório para excluir." },
189         { status: 400 }
190       );
191     }
192 
193     await prisma.event.delete({
194       where: { id },
195     });
196 
197     return NextResponse.json({ ok: true }, { status: 200 });
198   } catch (err) {
199     console.error("Erro ao excluir evento:", err);
200     return NextResponse.json(
201       { error: "Erro ao excluir evento." },
202       { status: 500 }
203     );
204   }
205 }

===== app/(app)/checkout/[slug]/page.tsx =====
1 import CheckoutClient from "./CheckoutClient";
2 
3 export default function CheckoutPage({ params }: { params: { slug: string } }) {
4   return <CheckoutClient slug={params.slug} />;
5 }

===== app/(app)/checkout/[slug]/CheckoutClient.tsx =====
1 "use client";
2 
3 import { useEffect, useState } from "react";
4 import { useParams } from "next/navigation";
5 
6 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
7 
8 type Event = {
9   id: string;
10   name: string;
11   type: EventType;
12   description?: string | null;
13   location?: string | null;
14   eventDate?: string | null;
15 };
16 
17 type Props = {
18   slug: string;
19 };
20 
21 function formatDate(iso?: string | null) {
22   if (!iso) return null;
23   const d = new Date(iso);
24   if (Number.isNaN(d.getTime())) return null;
25 
26   const dia = String(d.getUTCDate()).padStart(2, "0");
27   const mes = String(d.getUTCMonth() + 1).padStart(2, "0");
28   const ano = d.getUTCFullYear();
29   return `${dia}/${mes}/${ano}`;
30 }
31 
32 export default function CheckoutClient({ slug }: Props) {
33   const params = useParams() as { slug?: string };
34   const effectiveSlug = String(params?.slug ?? slug ?? "").trim();
35 
36   const [event, setEvent] = useState<Event | null>(null);
37   const [loadingEvent, setLoadingEvent] = useState(true);
38   const [eventError, setEventError] = useState<string | null>(null);
39 
40   const [name, setName] = useState("");
41   const [email, setEmail] = useState("");
42   const [document, setDocument] = useState("");
43   const [processing, setProcessing] = useState(false);
44   const [checkoutMessage, setCheckoutMessage] = useState<string | null>(null);
45   const [formError, setFormError] = useState<string | null>(null);
46 
47   useEffect(() => {
48     let active = true;
49 
50     async function loadEvent() {
51       try {
52         setLoadingEvent(true);
53         setEventError(null);
54         setEvent(null);
55 
56         if (!effectiveSlug) {
57           setEventError("Link de checkout inválido.");
58           return;
59         }
60 
61         const res = await fetch(
62           `/api/events/by-invite/${encodeURIComponent(effectiveSlug)}`
63         );
64 
65         if (!res.ok) {
66           const data = await res.json().catch(() => null);
67           if (!active) return;
68 
69           if (res.status === 404) {
70             setEventError("Nenhum evento encontrado para este link de checkout.");
71           } else {
72             setEventError(
73               data?.error ?? "Erro ao carregar informações do evento."
74             );
75           }
76           return;
77         }
78 
79         const data = (await res.json()) as Event;
80         if (!active) return;
81 
82         setEvent(data);
83       } catch (err) {
84         console.error("[CheckoutClient] Erro ao carregar evento:", err);
85         if (!active) return;
86         setEventError("Erro inesperado ao carregar informações do evento.");
87       } finally {
88         if (!active) return;
89         setLoadingEvent(false);
90       }
91     }
92 
93     loadEvent();
94 
95     return () => {
96       active = false;
97     };
98     // eslint-disable-next-line react-hooks/exhaustive-deps
99   }, [effectiveSlug]);
100 
101   async function handleSubmit(e: React.FormEvent) {
102     e.preventDefault();
103 
104     const trimmedName = name.trim();
105     const trimmedEmail = email.trim();
106 
107     if (!trimmedName || !trimmedEmail) {
108       setFormError("Preencha pelo menos nome e e-mail para continuar.");
109       setCheckoutMessage(null);
110       return;
111     }
112 
113     if (!event) {
114       setFormError(
115         "Ainda não foi possível identificar o evento deste checkout. Tente novamente em alguns segundos."
116       );
117       setCheckoutMessage(null);
118       return;
119     }
120 
121     try {
122       setProcessing(true);
123       setFormError(null);
124       setCheckoutMessage(null);
125 
126       // Aqui no futuro entra a chamada real para o gateway de pagamento
127       await new Promise((resolve) => setTimeout(resolve, 1200));
128 
129       setCheckoutMessage(
130         "Dados recebidos com sucesso. Em breve, aqui será redirecionado para a tela de pagamento (checkout real)."
131       );
132     } catch (err) {
133       console.error("[CheckoutClient] Erro no fluxo de checkout simulado:", err);
134       setFormError(
135         "Erro inesperado ao iniciar o pagamento. Tente novamente em instantes."
136       );
137     } finally {
138       setProcessing(false);
139     }
140   }
141 
142   const formattedDate = formatDate(event?.eventDate);
143 
144   return (
145     <div className="min-h-screen bg-slate-950 text-slate-50">
146       <div className="max-w-2xl mx-auto px-4 py-10 flex flex-col gap-8">
147         <header className="space-y-2">
148           <p className="text-[11px] font-semibold uppercase tracking-[0.2em] text-emerald-400">
149             Checkout do evento
150           </p>
151 
152           <h1 className="text-2xl sm:text-3xl font-semibold text-slate-50">
153             {event?.name ?? "Confirmação e pagamento"}
154           </h1>
155 
156           <p className="text-sm text-slate-400 max-w-xl">
157             Preencha seus dados para seguir para a etapa de pagamento deste
158             evento. Nesta primeira versão, estamos apenas simulando o fluxo de
159             checkout.
160           </p>
161         </header>
162 
163         <section className="space-y-3 text-sm">
164           <h2 className="text-sm font-semibold text-slate-200">
165             Detalhes do evento
166           </h2>
167 
168           <div className="rounded-2xl border border-slate-800 bg-slate-900/40 p-4 space-y-2">
169             {loadingEvent && (
170               <p className="text-xs text-slate-400">
171                 Carregando informações do evento...
172               </p>
173             )}
174 
175             {!loadingEvent && eventError && (
176               <p className="text-xs text-red-400">{eventError}</p>
177             )}
178 
179             {!loadingEvent && !eventError && event && (
180               <div className="space-y-1 text-xs sm:text-sm text-slate-300">
181                 <p>
182                   <span className="font-semibold text-slate-100">Evento:</span>{" "}
183                   {event.name}
184                 </p>
185 
186                 {formattedDate && (
187                   <p>
188                     <span className="font-semibold text-slate-100">Data:</span>{" "}
189                     {formattedDate}
190                   </p>
191                 )}
192 
193                 {event.location && (
194                   <p>
195                     <span className="font-semibold text-slate-100">Local:</span>{" "}
196                     {event.location}
197                   </p>
198                 )}
199 
200                 <p>
201                   <span className="font-semibold text-slate-100">Tipo:</span>{" "}
202                   {event.type === "PRE_PAGO"
203                     ? "Evento pré-pago"
204                     : event.type === "POS_PAGO"
205                     ? "Evento pós-pago"
206                     : "Evento gratuito"}
207                 </p>
208 
209                 {event.description && (
210                   <p className="pt-1">
211                     <span className="font-semibold text-slate-100">
212                       Descrição:
213                     </span>{" "}
214                     {event.description}
215                   </p>
216                 )}
217               </div>
218             )}
219 
220             {!loadingEvent && !eventError && !event && (
221               <p className="text-xs text-slate-400">
222                 Não foi possível carregar informações do evento.
223               </p>
224             )}
225           </div>
226         </section>
227 
228         <section className="space-y-3">
229           <h2 className="text-sm font-semibold text-slate-200">
230             Seus dados para o pagamento
231           </h2>
232 
233           <form onSubmit={handleSubmit} className="flex flex-col gap-3">
234             <div className="flex flex-col gap-1">
235               <label className="text-xs font-medium text-slate-300">
236                 Nome completo
237               </label>
238               <input
239                 type="text"
240                 value={name}
241                 onChange={(e) => setName(e.target.value)}
242                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
243                 placeholder="Digite seu nome completo"
244                 disabled={processing || !!eventError}
245               />
246             </div>
247 
248             <div className="flex flex-col gap-1">
249               <label className="text-xs font-medium text-slate-300">
250                 E-mail
251               </label>
252               <input
253                 type="email"
254                 value={email}
255                 onChange={(e) => setEmail(e.target.value)}
256                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
257                 placeholder="Digite seu e-mail"
258                 disabled={processing || !!eventError}
259               />
260             </div>
261 
262             <div className="flex flex-col gap-1">
263               <label className="text-xs font-medium text-slate-300">
264                 Documento (CPF ou similar)
265               </label>
266               <input
267                 type="text"
268                 value={document}
269                 onChange={(e) => setDocument(e.target.value)}
270                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
271                 placeholder="Opcional nesta versão de teste"
272                 disabled={processing || !!eventError}
273               />
274             </div>
275 
276             {formError && (
277               <p className="text-[11px] text-red-400">{formError}</p>
278             )}
279 
280             <button
281               type="submit"
282               disabled={processing || !!eventError}
283               className="mt-1 inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
284             >
285               {processing
286                 ? "Iniciando pagamento..."
287                 : "Confirmar dados e continuar para o pagamento"}
288             </button>
289           </form>
290 
291           {checkoutMessage && (
292             <div className="mt-2 rounded-lg border border-emerald-700 bg-emerald-900/20 px-3 py-2">
293               <p className="text-xs text-emerald-300">
294                 {checkoutMessage}
295               </p>
296               <p className="mt-1 text-[10px] text-emerald-200/80">
297                 Em uma próxima etapa, esta tela irá redirecionar para o gateway
298                 de pagamento (PIX, cartão, etc.).
299               </p>
300             </div>
301           )}
302         </section>
303 
304         <footer className="pt-4 border-t border-slate-900 text-[11px] text-slate-500 flex flex-wrap items-center justify-between gap-2">
305           <span className="break-all">
306             Código do checkout:{" "}
307             <span className="text-slate-300">
308               {effectiveSlug || "(não informado)"}
309             </span>
310           </span>
311         </footer>
312       </div>
313     </div>
314   );
315 }
