
===== app/(app)/eventos/[id]/pre/page.tsx =====
1 import EventTipoClient from "../EventTipoClient";
2 
3 export default function EventoPrePagoPage() {
4   return <EventTipoClient mode="pre" />;
5 }

===== app/(app)/eventos/[id]/EventTipoClient.tsx =====
1 "use client";
2 
3 import { useEffect, useState } from "react";
4 import Link from "next/link";
5 import { useParams } from "next/navigation";
6 
7 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
8 
9 type Event = {
10   id: string;
11   name: string;
12   type: EventType;
13   description?: string | null;
14   location?: string | null;
15   createdAt?: string;
16 };
17 
18 type Mode = "free" | "pre" | "pos";
19 
20 type Props = {
21   mode: Mode;
22 };
23 
24 function getTitle(mode: Mode) {
25   if (mode === "pre") return "Evento pré pago";
26   if (mode === "pos") return "Evento pós pago";
27   return "Evento free";
28 }
29 
30 function getDescription(mode: Mode) {
31   if (mode === "pre") {
32     return "Aqui terá a lógica do evento pré pago.";
33   }
34   if (mode === "pos") {
35     return "Aqui terá a lógica do evento pós pago.";
36   }
37   return "Aqui terá a lógica do evento free.";
38 }
39 
40 export default function EventTipoClient({ mode }: Props) {
41   const params = useParams() as { id?: string };
42   const eventId = String(params?.id ?? "").trim();
43 
44   const [event, setEvent] = useState<Event | null>(null);
45   const [loading, setLoading] = useState(true);
46   const [error, setError] = useState<string | null>(null);
47 
48   useEffect(() => {
49     let active = true;
50 
51     async function load() {
52       try {
53         setLoading(true);
54         setError(null);
55 
56         console.log("[EventTipoClient] params.id:", params?.id, "eventId:", eventId);
57 
58         if (!eventId) {
59           setError("Evento não encontrado.");
60           setEvent(null);
61           return;
62         }
63 
64         console.log("[EventTipoClient] Carregando evento de /api/events/[id]...");
65         const res = await fetch(`/api/events/${eventId}`);
66 
67         if (!res.ok) {
68           const data = await res.json().catch(() => null);
69           if (!active) return;
70 
71           setError(data?.error ?? "Erro ao carregar evento.");
72           setEvent(null);
73           return;
74         }
75 
76         const data = (await res.json()) as Event;
77         if (!active) return;
78 
79         setEvent(data);
80       } catch (err) {
81         console.error("[EventTipoClient] Erro no fetch:", err);
82         if (!active) return;
83         setError("Erro inesperado ao carregar evento.");
84         setEvent(null);
85       } finally {
86         if (!active) return;
87         setLoading(false);
88       }
89     }
90 
91     load();
92 
93     return () => {
94       active = false;
95     };
96     // eslint-disable-next-line react-hooks/exhaustive-deps
97   }, [eventId, mode]);
98 
99   return (
100     <div className="min-h-screen bg-slate-950 text-slate-50 flex flex-col">
101       <header className="flex items-center justify-between px-6 py-4 border-b border-slate-800">
102         <Link
103           href="/dashboard/"
104           className="text-xs font-medium text-slate-300 hover:text-slate-100"
105         >
106           ← Voltar
107         </Link>
108 
109         {event && (
110           <span className="inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-[11px] font-medium uppercase tracking-wide text-slate-300 border border-slate-700">
111             {event.type}
112           </span>
113         )}
114       </header>
115 
116       <main className="flex-1 px-4 py-6 sm:px-6 lg:px-8 max-w-3xl w-full mx-auto flex flex-col gap-4">
117         {loading && (
118           <p className="text-sm text-slate-300">Carregando evento...</p>
119         )}
120 
121         {error && !loading && (
122           <p className="text-sm text-red-400">{error}</p>
123         )}
124 
125         {!loading && !error && !event && (
126           <p className="text-sm text-slate-300">
127             Evento não encontrado.
128           </p>
129         )}
130 
131         {event && (
132           <>
133             <h1 className="text-xl sm:text-2xl font-semibold text-slate-50">
134               {event.name}
135             </h1>
136 
137             <h2 className="text-sm font-medium text-slate-200">
138               {getTitle(mode)}
139             </h2>
140 
141             <p className="text-sm text-slate-300">
142               {getDescription(mode)}
143             </p>
144 
145             <p className="mt-4 text-[11px] text-slate-500">
146               (No futuro, aqui vamos montar toda a lógica detalhada desse tipo
147               de evento: configurações, regras, integrações, fluxos, etc.)
148             </p>
149           </>
150         )}
151       </main>
152     </div>
153   );
154 }

===== app/(app)/dashboard/DashboardClient.tsx =====
1 "use client";
2 
3 import { useEffect, useState } from "react";
4 import { useRouter } from "next/navigation";
5 
6 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
7 
8 type Event = {
9   id: string;
10   name: string;
11   type: EventType;
12   createdAt: string;
13 };
14 
15 function getTypeLabel(type: EventType) {
16   if (type === "PRE_PAGO") return "Pré pago";
17   if (type === "POS_PAGO") return "Pós pago";
18   return "Free";
19 }
20 
21 function getEventHref(event: Event) {
22   if (event.type === "PRE_PAGO") return `/eventos/${event.id}/pre`;
23   if (event.type === "POS_PAGO") return `/eventos/${event.id}/pos`;
24   return `/eventos/${event.id}/free`;
25 }
26 
27 export default function DashboardClient() {
28   const router = useRouter();
29 
30   const [events, setEvents] = useState<Event[]>([]);
31   const [loading, setLoading] = useState(true);
32   const [error, setError] = useState<string | null>(null);
33 
34   const [name, setName] = useState("");
35   const [type, setType] = useState<EventType>("FREE");
36   const [creating, setCreating] = useState(false);
37 
38   useEffect(() => {
39     let active = true;
40 
41     async function load() {
42       try {
43         setLoading(true);
44         setError(null);
45 
46         const res = await fetch("/api/events");
47         if (!res.ok) {
48           const data = await res.json().catch(() => null);
49           if (!active) return;
50           setError(data?.error ?? "Erro ao carregar eventos.");
51           return;
52         }
53 
54         const data = (await res.json()) as Event[];
55         if (!active) return;
56         setEvents(data);
57       } catch (err) {
58         console.error(err);
59         if (!active) return;
60         setError("Erro inesperado ao carregar eventos.");
61       } finally {
62         if (!active) return;
63         setLoading(false);
64       }
65     }
66 
67     load();
68 
69     return () => {
70       active = false;
71     };
72   }, []);
73 
74   async function handleCreate(e: React.FormEvent) {
75     e.preventDefault();
76     if (!name.trim()) {
77       setError("Informe um nome para o evento.");
78       return;
79     }
80 
81     try {
82       setCreating(true);
83       setError(null);
84 
85       const res = await fetch("/api/events", {
86         method: "POST",
87         headers: {
88           "Content-Type": "application/json",
89         },
90         body: JSON.stringify({
91           name,
92           type,
93         }),
94       });
95 
96       if (!res.ok) {
97         const data = await res.json().catch(() => null);
98         setError(data?.error ?? "Erro ao criar evento.");
99         return;
100       }
101 
102       const created = (await res.json()) as Event;
103 
104       setEvents((prev) => [created, ...prev]);
105       setName("");
106       setType("FREE");
107     } catch (err) {
108       console.error(err);
109       setError("Erro inesperado ao criar evento.");
110     } finally {
111       setCreating(false);
112     }
113   }
114 
115   async function handleDelete(id: string) {
116     try {
117       setError(null);
118 
119       const res = await fetch("/api/events", {
120         method: "DELETE",
121         headers: {
122           "Content-Type": "application/json",
123         },
124         body: JSON.stringify({ id }),
125       });
126 
127       if (!res.ok) {
128         const data = await res.json().catch(() => null);
129         setError(data?.error ?? "Erro ao excluir evento.");
130         return;
131       }
132 
133       setEvents((prev) => prev.filter((e) => e.id !== id));
134     } catch (err) {
135       console.error(err);
136       setError("Erro inesperado ao excluir evento.");
137     }
138   }
139 
140   return (
141     <div className="min-h-screen bg-slate-950 text-slate-50 flex flex-col">
142       <header className="flex items-center justify-between px-6 py-4 border-b border-slate-800">
143         <h1 className="text-lg sm:text-xl font-semibold">
144           Meus eventos
145         </h1>
146 
147         <button
148           type="button"
149           className="text-xs font-medium text-slate-300 hover:text-slate-100"
150         >
151           Sair
152         </button>
153       </header>
154 
155       <main className="flex-1 px-4 py-6 sm:px-6 lg:px-8 max-w-5xl w-full mx-auto flex flex-col gap-6">
156         {/* Form de criação */}
157         <form
158           onSubmit={handleCreate}
159           className="flex flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-900/50 p-4 sm:flex-row sm:items-end sm:gap-4"
160         >
161           <div className="flex-1 flex flex-col gap-1">
162             <label className="text-xs font-medium text-slate-300">
163               Nome do evento
164             </label>
165             <input
166               type="text"
167               value={name}
168               onChange={(e) => setName(e.target.value)}
169               className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
170               placeholder="Digite o nome do evento"
171             />
172           </div>
173 
174           <div className="w-full sm:w-40 flex flex-col gap-1">
175             <label className="text-xs font-medium text-slate-300">
176               Tipo
177             </label>
178             <select
179               value={type}
180               onChange={(e) => setType(e.target.value as EventType)}
181               className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
182             >
183               <option value="FREE">Free</option>
184               <option value="PRE_PAGO">Pré pago</option>
185               <option value="POS_PAGO">Pós pago</option>
186             </select>
187           </div>
188 
189           <button
190             type="submit"
191             disabled={creating}
192             className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
193           >
194             {creating ? "Criando..." : "Adicionar evento"}
195           </button>
196         </form>
197 
198         {error && (
199           <p className="text-sm text-red-400">
200             {error}
201           </p>
202         )}
203 
204         {loading && (
205           <p className="text-sm text-slate-300">Carregando eventos...</p>
206         )}
207 
208         {!loading && events.length === 0 && (
209           <p className="text-sm text-slate-400">
210             Nenhum evento criado ainda. Crie o primeiro acima.
211           </p>
212         )}
213 
214         {/* Grid de cards */}
215         <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
216           {events.map((event) => (
217             <div
218               key={event.id}
219               onClick={() => router.push(getEventHref(event))}
220               className="flex flex-col gap-2 rounded-2xl border border-slate-800 bg-slate-900/60 p-4 cursor-pointer hover:border-emerald-500/70 hover:bg-slate-800/60 transition"
221             >
222               {/* Linha: tipo à esquerda, excluir à direita */}
223               <div className="flex items-center justify-between gap-2">
224                 <span className="text-[11px] uppercase tracking-wide text-slate-400">
225                   {getTypeLabel(event.type)}
226                 </span>
227 
228                 <button
229                   type="button"
230                   onClick={(e) => {
231                     e.stopPropagation();
232                     const confirmed = window.confirm(
233                       "Deseja realmente excluir este evento? Essa ação não pode ser desfeita."
234                     );
235                     if (!confirmed) return;
236                     void handleDelete(event.id);
237                   }}
238                   className="inline-flex items-center justify-center rounded-lg border border-red-600 px-2.5 py-1 text-[11px] font-medium text-red-400 hover:bg-red-950/50"
239                 >
240                   Excluir
241                 </button>
242               </div>
243 
244               {/* Nome do evento abaixo */}
245               <h2 className="text-sm font-semibold text-slate-50 line-clamp-2">
246                 {event.name}
247               </h2>
248             </div>
249           ))}
250         </div>
251       </main>
252     </div>
253   );
254 }

===== app/api/events/route.ts =====
1 import { NextRequest, NextResponse } from "next/server";
2 import { prisma } from "@/lib/prisma";
3 
4 const VALID_TYPES = ["PRE_PAGO", "POS_PAGO", "FREE"] as const;
5 type EventType = (typeof VALID_TYPES)[number];
6 
7 // GET /api/events - lista todos os eventos
8 export async function GET(_request: NextRequest) {
9   const events = await prisma.event.findMany({
10     orderBy: { createdAt: "desc" },
11   });
12 
13   return NextResponse.json(events, { status: 200 });
14 }
15 
16 // POST /api/events - cria um novo evento
17 export async function POST(request: NextRequest) {
18   try {
19     const body = await request.json();
20     const name = String(body.name ?? "").trim();
21     const type = String(body.type ?? "").toUpperCase() as EventType;
22 
23     if (!name) {
24       return NextResponse.json(
25         { error: "Nome do evento é obrigatório." },
26         { status: 400 }
27       );
28     }
29 
30     if (!VALID_TYPES.includes(type)) {
31       return NextResponse.json(
32         { error: "Tipo de evento inválido." },
33         { status: 400 }
34       );
35     }
36 
37     const event = await prisma.event.create({
38       data: {
39         name,
40         type,
41       },
42     });
43 
44     return NextResponse.json(event, { status: 201 });
45   } catch (err) {
46     console.error("Erro ao criar evento:", err);
47     return NextResponse.json(
48       { error: "Erro ao criar evento." },
49       { status: 500 }
50     );
51   }
52 }
53 
54 // PATCH /api/events - atualiza um evento existente (id no corpo)
55 export async function PATCH(request: NextRequest) {
56   try {
57     const body = await request.json();
58     const id = String(body.id ?? "").trim();
59 
60     if (!id) {
61       return NextResponse.json(
62         { error: "ID do evento é obrigatório para atualizar." },
63         { status: 400 }
64       );
65     }
66 
67     const data: {
68       name?: string;
69       description?: string | null;
70       location?: string | null;
71       inviteSlug?: string | null;
72       eventDate?: Date | null;
73     } = {};
74 
75     if (typeof body.name === "string") {
76       const name = body.name.trim();
77       if (!name) {
78         return NextResponse.json(
79           { error: "Nome do evento não pode ser vazio." },
80           { status: 400 }
81         );
82       }
83       data.name = name;
84     }
85 
86     if (typeof body.description === "string" || body.description === null) {
87       data.description = body.description;
88     }
89 
90     if (typeof body.location === "string" || body.location === null) {
91       data.location = body.location;
92     }
93 
94     if (typeof body.inviteSlug === "string" || body.inviteSlug === null) {
95       data.inviteSlug = body.inviteSlug;
96     }
97 
98     // Trata eventDate vindo da tela free (string "YYYY-MM-DD" ou null)
99     if (typeof body.eventDate === "string" || body.eventDate === null) {
100       if (!body.eventDate) {
101         data.eventDate = null;
102       } else {
103         const d = new Date(body.eventDate);
104         if (Number.isNaN(d.getTime())) {
105           return NextResponse.json(
106             { error: "Data do evento inválida." },
107             { status: 400 }
108           );
109         }
110         data.eventDate = d;
111       }
112     }
113 
114     if (Object.keys(data).length === 0) {
115       return NextResponse.json(
116         { error: "Nenhum campo para atualizar." },
117         { status: 400 }
118       );
119     }
120 
121     const updated = await prisma.event.update({
122       where: { id },
123       data,
124     });
125 
126     return NextResponse.json(updated, { status: 200 });
127   } catch (err) {
128     console.error("Erro ao atualizar evento:", err);
129     return NextResponse.json(
130       { error: "Erro ao atualizar evento." },
131       { status: 500 }
132     );
133   }
134 }
135 
136 // DELETE /api/events - exclui um evento (id no corpo)
137 export async function DELETE(request: NextRequest) {
138   try {
139     const body = await request.json();
140     const id = String(body.id ?? "").trim();
141 
142     if (!id) {
143       return NextResponse.json(
144         { error: "ID do evento é obrigatório para excluir." },
145         { status: 400 }
146       );
147     }
148 
149     await prisma.event.delete({
150       where: { id },
151     });
152 
153     return NextResponse.json({ ok: true }, { status: 200 });
154   } catch (err) {
155     console.error("Erro ao excluir evento:", err);
156     return NextResponse.json(
157       { error: "Erro ao excluir evento." },
158       { status: 500 }
159     );
160   }
161 }
