
===== app/layout.tsx =====
1 import type { Metadata } from "next";
2 import type { ReactNode } from "react";
3 import "./globals.css";
4 import { PwaProvider } from "@/components/PwaProvider";
5 import { MercadoPagoProvider } from "@/components/MercadoPagoProvider";
6 
7 export const metadata: Metadata = {
8   title: "Eventos",
9   description: "App de eventos",
10 };
11 
12 type RootLayoutProps = {
13   children: ReactNode;
14 };
15 
16 export default function RootLayout({ children }: RootLayoutProps) {
17   return (
18     <html lang="pt-BR">
19       <body>
20         {/* PWA só como efeito colateral */}
21         <PwaProvider />
22         {/* Mercado Pago envolvendo a árvore */}
23         <MercadoPagoProvider>
24           {children}
25         </MercadoPagoProvider>
26       </body>
27     </html>
28   );
29 }

===== app/globals.css =====
1 @import "tailwindcss";
2 
3 :root {
4   color-scheme: dark;
5 }
6 
7 body {
8   margin: 0;
9   min-height: 100vh;
10   background-color: #020617; /* equivalente ao bg-slate-950 */
11   color: #e5e7eb;            /* equivalente ao text-slate-200 */
12   font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
13 }

===== tailwind.config.ts =====
1 import type { Config } from "tailwindcss";
2 
3 const config: Config = {
4   content: [
5     "./app/**/*.{js,ts,jsx,tsx}",
6     "./components/**/*.{js,ts,jsx,tsx}",
7   ],
8   theme: {
9     extend: {},
10   },
11   plugins: [],
12 };
13 
14 export default config;

===== components/ui/button.tsx =====
1 import { ComponentProps } from "react";
2 
3 type ButtonProps = ComponentProps<"button"> & {
4   variant?: "primary" | "ghost";
5 };
6 
7 export function Button({ className = "", variant = "primary", ...props }: ButtonProps) {
8   const base =
9     "inline-flex items-center justify-center rounded-lg px-4 py-2 text-sm font-semibold transition-colors disabled:opacity-60 disabled:cursor-not-allowed";
10 
11   const variantClass =
12     variant === "primary"
13       ? "bg-indigo-500 text-white hover:bg-indigo-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400"
14       : "bg-transparent text-indigo-300 hover:bg-indigo-900/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400";
15 
16   const classes = `${base} ${variantClass} ${className}`.trim();
17 
18   return <button className={classes} {...props} />;
19 }

===== components/ui/input.tsx =====
1 import { ComponentProps } from "react";
2 
3 type InputProps = ComponentProps<"input"> & {
4   label?: string;
5   error?: string;
6 };
7 
8 export function Input({ label, error, className = "", ...props }: InputProps) {
9   const base =
10     "w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500";
11 
12   const errorClass = error ? "border-red-500 focus-visible:ring-red-500" : "";
13 
14   const classes = `${base} ${errorClass} ${className}`.trim();
15 
16   return (
17     <label className="flex flex-col gap-1 text-sm">
18       {label && <span className="font-medium text-slate-200">{label}</span>}
19       <input className={classes} {...props} />
20       {error && <span className="text-xs text-red-400">{error}</span>}
21     </label>
22   );
23 }

===== components/ui/form-message.tsx =====
1 type FormMessageProps = {
2   type: "error" | "success";
3   message?: string;
4 };
5 
6 export function FormMessage({ type, message }: FormMessageProps) {
7   if (!message) return null;
8 
9   const base =
10     "mt-2 rounded-md px-3 py-2 text-sm border flex items-center gap-2";
11 
12   const styles =
13     type === "error"
14       ? "border-red-500 bg-red-500/10 text-red-200"
15       : "border-emerald-500 bg-emerald-500/10 text-emerald-200";
16 
17   return <div className={`${base} ${styles}`}>{message}</div>;
18 }

===== components/auth/AuthLayout.tsx =====
1 import Link from "next/link";
2 
3 type AuthLayoutProps = {
4   title: string;
5   subtitle: string;
6   children: React.ReactNode;
7 };
8 
9 export function AuthLayout({ title, subtitle, children }: AuthLayoutProps) {
10   return (
11     <div className="flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 px-4">
12       <div className="w-full max-w-md">
13         <div className="mb-8 text-center">
14           <div className="inline-flex items-center gap-2 rounded-full bg-slate-900/80 px-3 py-1 text-xs text-slate-300 shadow">
15             <span className="h-2 w-2 rounded-full bg-emerald-400" />
16             <span>PWA pronto para instalar</span>
17           </div>
18           <h1 className="mt-4 text-2xl font-semibold text-slate-50">
19             {title}
20           </h1>
21           <p className="mt-1 text-sm text-slate-400">{subtitle}</p>
22         </div>
23 
24         <div className="rounded-2xl bg-slate-950/80 p-6 shadow-xl shadow-black/50 backdrop-blur">
25           {children}
26         </div>
27 
28         <p className="mt-6 text-center text-xs text-slate-500">
29           &copy; {new Date().getFullYear()} AuthApp.{" "}
30           <Link href="#" className="underline underline-offset-2">
31             Termos &amp; Privacidade
32           </Link>
33         </p>
34       </div>
35     </div>
36   );
37 }

===== app/page.tsx =====
1 import Link from "next/link";
2 
3 export default function HomePage() {
4   return (
5     <main className="flex min-h-screen flex-col items-center justify-center bg-slate-950 px-4">
6       <div className="w-full max-w-md rounded-2xl bg-slate-900/80 p-8 text-center text-slate-50 shadow-xl shadow-black/50">
7         <h1 className="text-2xl font-semibold">Auth PWA App</h1>
8         <p className="mt-2 text-sm text-slate-400">
9           Autenticação moderna, responsiva e pronta para PWA.
10         </p>
11         <div className="mt-6 flex justify-center gap-3 text-sm">
12           <Link
13             href="/login"
14             className="rounded-lg bg-indigo-500 px-4 py-2 font-semibold text-white hover:bg-indigo-400"
15           >
16             Entrar
17           </Link>
18           <Link
19             href="/register"
20             className="rounded-lg border border-slate-600 px-4 py-2 font-semibold text-slate-200 hover:bg-slate-800"
21           >
22             Criar conta
23           </Link>
24         </div>
25       </div>
26     </main>
27   );
28 }

===== app/(auth)/login/page.tsx =====
1 /* eslint-disable @typescript-eslint/no-explicit-any */
2 "use client";
3 
4 import { useState } from "react";
5 import Link from "next/link";
6 import { AuthLayout } from "@/components/auth/AuthLayout";
7 import { Input } from "@/components/ui/input";
8 import { Button } from "@/components/ui/button";
9 import { FormMessage } from "@/components/ui/form-message";
10 import { loginSchema } from "@/lib/validation";
11 import { z } from "zod";
12 import { useRouter } from "next/navigation";
13 
14 type LoginForm = z.infer<typeof loginSchema>;
15 
16 export default function LoginPage() {
17   const router = useRouter();
18   const [form, setForm] = useState<LoginForm>({
19     email: "",
20     password: "",
21   });
22   const [errors, setErrors] = useState<Partial<Record<keyof LoginForm, string>>>(
23     {}
24   );
25   const [showPassword, setShowPassword] = useState(false);
26   const [submitting, setSubmitting] = useState(false);
27   const [globalError, setGlobalError] = useState<string | undefined>();
28   const [globalSuccess, setGlobalSuccess] = useState<string | undefined>();
29 
30   const handleChange = (field: keyof LoginForm, value: string) => {
31     setForm((prev) => ({ ...prev, [field]: value }));
32     setErrors((prev) => ({ ...prev, [field]: undefined }));
33   };
34 
35   const handleSubmit = async (e: React.FormEvent) => {
36     e.preventDefault();
37     setGlobalError(undefined);
38     setGlobalSuccess(undefined);
39 
40     try {
41       const parsed = loginSchema.parse(form);
42       setErrors({});
43       setSubmitting(true);
44 
45       const res = await fetch("/api/auth/login", {
46         method: "POST",
47         headers: { "Content-Type": "application/json" },
48         body: JSON.stringify(parsed),
49       });
50 
51       const data = await res.json();
52 
53       if (!res.ok || !data.success) {
54         setGlobalError(data.message ?? "Credenciais inválidas");
55         return;
56       }
57 
58       setGlobalSuccess("Login realizado com sucesso!");
59       setTimeout(() => {
60         router.push("/dashboard");
61       }, 800);
62     } catch (err: any) {
63       if (err instanceof z.ZodError) {
64         const fieldErrors = err.flatten().fieldErrors as Record<string, string[]>;
65         setErrors({
66           email: fieldErrors.email?.[0],
67           password: fieldErrors.password?.[0],
68         });
69       } else {
70         setGlobalError("Erro inesperado ao fazer login");
71       }
72     } finally {
73       setSubmitting(false);
74     }
75   };
76 
77   return (
78     <AuthLayout
79       title="Bem-vindo de volta"
80       subtitle="Acesse sua conta para continuar."
81     >
82       <form onSubmit={handleSubmit} className="flex flex-col gap-4">
83         <Input
84           type="email"
85           label="E-mail"
86           placeholder="voce@exemplo.com"
87           autoComplete="email"
88           value={form.email}
89           onChange={(e) => handleChange("email", e.target.value)}
90           error={errors.email}
91         />
92 
93         <div className="space-y-1">
94           <div className="flex items-center justify-between">
95             <span className="text-sm font-medium text-slate-200">Senha</span>
96             <button
97               type="button"
98               className="text-xs text-indigo-300 hover:text-indigo-200"
99               onClick={() => setShowPassword((prev) => !prev)}
100             >
101               {showPassword ? "Ocultar" : "Mostrar"} senha
102             </button>
103           </div>
104           <Input
105             type={showPassword ? "text" : "password"}
106             placeholder="••••••••"
107             autoComplete="current-password"
108             value={form.password}
109             onChange={(e) => handleChange("password", e.target.value)}
110             error={errors.password}
111           />
112         </div>
113 
114         <div className="flex items-center justify-between text-xs text-slate-400">
115           <Link href="/recover" className="hover:text-indigo-300">
116             Esqueci minha senha
117           </Link>
118           <Link href="/register" className="hover:text-indigo-300">
119             Criar conta
120           </Link>
121         </div>
122 
123         <Button type="submit" className="mt-2 w-full" disabled={submitting}>
124           {submitting ? "Entrando..." : "Entrar"}
125         </Button>
126 
127         <FormMessage type="error" message={globalError} />
128         <FormMessage type="success" message={globalSuccess} />
129       </form>
130     </AuthLayout>
131   );
132 }

===== app/(auth)/register/page.tsx =====
1 /* eslint-disable @typescript-eslint/no-explicit-any */
2 "use client";
3 
4 import { useState } from "react";
5 import Link from "next/link";
6 import { AuthLayout } from "@/components/auth/AuthLayout";
7 import { Input } from "@/components/ui/input";
8 import { Button } from "@/components/ui/button";
9 import { FormMessage } from "@/components/ui/form-message";
10 import { registerSchema } from "@/lib/validation";
11 import { z } from "zod";
12 import { useRouter } from "next/navigation";
13 
14 type RegisterForm = z.infer<typeof registerSchema>;
15 
16 export default function RegisterPage() {
17   const router = useRouter();
18   const [form, setForm] = useState<RegisterForm>({
19     name: "",
20     email: "",
21     password: "",
22     confirmPassword: "",
23   });
24   const [errors, setErrors] = useState<
25     Partial<Record<keyof RegisterForm, string>>
26   >({});
27   const [submitting, setSubmitting] = useState(false);
28   const [globalError, setGlobalError] = useState<string | undefined>();
29   const [globalSuccess, setGlobalSuccess] = useState<string | undefined>();
30   const [showPassword, setShowPassword] = useState(false);
31 
32   const handleChange = (field: keyof RegisterForm, value: string) => {
33     setForm((prev) => ({ ...prev, [field]: value }));
34     setErrors((prev) => ({ ...prev, [field]: undefined }));
35   };
36 
37   const handleSubmit = async (e: React.FormEvent) => {
38     e.preventDefault();
39     setGlobalError(undefined);
40     setGlobalSuccess(undefined);
41 
42     try {
43       const parsed = registerSchema.parse(form);
44       setErrors({});
45       setSubmitting(true);
46 
47       const res = await fetch("/api/auth/register", {
48         method: "POST",
49         headers: { "Content-Type": "application/json" },
50         body: JSON.stringify(parsed),
51       });
52 
53       const data = await res.json();
54 
55       if (!res.ok || !data.success) {
56         setGlobalError(data.message ?? "Erro ao criar conta");
57         return;
58       }
59 
60       setGlobalSuccess("Conta criada com sucesso! Redirecionando para login...");
61       setTimeout(() => {
62         router.push("/login");
63       }, 1000);
64     } catch (err: any) {
65       if (err instanceof z.ZodError) {
66         const fieldErrors = err.flatten().fieldErrors as Record<string, string[]>;
67         setErrors({
68           name: fieldErrors.name?.[0],
69           email: fieldErrors.email?.[0],
70           password: fieldErrors.password?.[0],
71           confirmPassword: fieldErrors.confirmPassword?.[0],
72         });
73       } else {
74         setGlobalError("Erro inesperado ao criar conta");
75       }
76     } finally {
77       setSubmitting(false);
78     }
79   };
80 
81   return (
82     <AuthLayout
83       title="Criar conta"
84       subtitle="Leva menos de um minuto para começar."
85     >
86       <form onSubmit={handleSubmit} className="flex flex-col gap-4">
87         <Input
88           label="Nome completo"
89           placeholder="Seu nome"
90           autoComplete="name"
91           value={form.name}
92           onChange={(e) => handleChange("name", e.target.value)}
93           error={errors.name}
94         />
95 
96         <Input
97           type="email"
98           label="E-mail"
99           placeholder="voce@exemplo.com"
100           autoComplete="email"
101           value={form.email}
102           onChange={(e) => handleChange("email", e.target.value)}
103           error={errors.email}
104         />
105 
106         <div className="space-y-1">
107           <div className="flex items-center justify-between">
108             <span className="text-sm font-medium text-slate-200">Senha</span>
109             <button
110               type="button"
111               className="text-xs text-indigo-300 hover:text-indigo-200"
112               onClick={() => setShowPassword((prev) => !prev)}
113             >
114               {showPassword ? "Ocultar" : "Mostrar"} senha
115             </button>
116           </div>
117           <Input
118             type={showPassword ? "text" : "password"}
119             placeholder="••••••••"
120             autoComplete="new-password"
121             value={form.password}
122             onChange={(e) => handleChange("password", e.target.value)}
123             error={errors.password}
124           />
125           <p className="mt-1 text-xs text-slate-400">
126             Use pelo menos 8 caracteres, com maiúsculas, minúsculas, número e
127             símbolo.
128           </p>
129         </div>
130 
131         <Input
132           type={showPassword ? "text" : "password"}
133           label="Confirmar senha"
134           placeholder="Repita a senha"
135           autoComplete="new-password"
136           value={form.confirmPassword}
137           onChange={(e) =>
138             handleChange("confirmPassword", e.target.value)
139           }
140           error={errors.confirmPassword}
141         />
142 
143         <Button type="submit" className="mt-2 w-full" disabled={submitting}>
144           {submitting ? "Criando conta..." : "Criar conta"}
145         </Button>
146 
147         <p className="mt-2 text-center text-xs text-slate-400">
148           Já tem conta?{" "}
149           <Link href="/login" className="text-indigo-300 hover:text-indigo-200">
150             Entrar
151           </Link>
152         </p>
153 
154         <FormMessage type="error" message={globalError} />
155         <FormMessage type="success" message={globalSuccess} />
156       </form>
157     </AuthLayout>
158   );
159 }

===== app/(app)/dashboard/page.tsx =====
1 import DashboardClient from "./DashboardClient";
2 
3 export default function DashboardPage() {
4   return <DashboardClient />;
5 }

===== app/(app)/dashboard/DashboardClient.tsx =====
1 "use client";
2 
3 import { useEffect, useState } from "react";
4 import { useRouter } from "next/navigation";
5 import Link from "next/link";
6 
7 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
8 
9 type Event = {
10   id: string;
11   name: string;
12   type: EventType;
13   createdAt: string;
14 };
15 
16 function getTypeLabel(type: EventType) {
17   if (type === "PRE_PAGO") return "Pré pago";
18   if (type === "POS_PAGO") return "Pós pago";
19   return "Free";
20 }
21 
22 function getEventHref(event: Event) {
23   if (event.type === "PRE_PAGO") return `/eventos/${event.id}/pre`;
24   if (event.type === "POS_PAGO") return `/eventos/${event.id}/pos`;
25   return `/eventos/${event.id}/free`;
26 }
27 
28 export default function DashboardClient() {
29   const router = useRouter();
30 
31   const [events, setEvents] = useState<Event[]>([]);
32   const [loading, setLoading] = useState(true);
33   const [error, setError] = useState<string | null>(null);
34 
35   const [name, setName] = useState("");
36   const [type, setType] = useState<EventType>("FREE");
37   const [creating, setCreating] = useState(false);
38 
39   useEffect(() => {
40     let active = true;
41 
42     async function load() {
43       try {
44         setLoading(true);
45         setError(null);
46 
47         const res = await fetch("/api/events");
48         if (!res.ok) {
49           const data = await res.json().catch(() => null);
50           if (!active) return;
51           setError(data?.error ?? "Erro ao carregar eventos.");
52           return;
53         }
54 
55         const data = (await res.json()) as Event[];
56         if (!active) return;
57         setEvents(data);
58       } catch (err) {
59         console.error(err);
60         if (!active) return;
61         setError("Erro inesperado ao carregar eventos.");
62       } finally {
63         if (!active) return;
64         setLoading(false);
65       }
66     }
67 
68     void load();
69 
70     return () => {
71       active = false;
72     };
73   }, []);
74 
75   async function handleCreate(e: React.FormEvent) {
76     e.preventDefault();
77     if (!name.trim()) {
78       setError("Informe um nome para o evento.");
79       return;
80     }
81 
82     try {
83       setCreating(true);
84       setError(null);
85 
86       const res = await fetch("/api/events", {
87         method: "POST",
88         headers: {
89           "Content-Type": "application/json",
90         },
91         body: JSON.stringify({
92           name,
93           type,
94         }),
95       });
96 
97       if (!res.ok) {
98         const data = await res.json().catch(() => null);
99         setError(data?.error ?? "Erro ao criar evento.");
100         return;
101       }
102 
103       const created = (await res.json()) as Event;
104 
105       setEvents((prev) => [created, ...prev]);
106       setName("");
107       setType("FREE");
108     } catch (err) {
109       console.error(err);
110       setError("Erro inesperado ao criar evento.");
111     } finally {
112       setCreating(false);
113     }
114   }
115 
116   async function handleDelete(id: string) {
117     try {
118       setError(null);
119 
120       const res = await fetch("/api/events", {
121         method: "DELETE",
122         headers: {
123           "Content-Type": "application/json",
124         },
125         body: JSON.stringify({ id }),
126       });
127 
128       if (!res.ok) {
129         const data = await res.json().catch(() => null);
130         setError(data?.error ?? "Erro ao excluir evento.");
131         return;
132       }
133 
134       setEvents((prev) => prev.filter((e) => e.id !== id));
135     } catch (err) {
136       console.error(err);
137       setError("Erro inesperado ao excluir evento.");
138     }
139   }
140 
141   return (
142     <div className="min-h-screen bg-slate-950 text-slate-50 flex flex-col">
143       <header className="flex items-center justify-between px-6 py-4 border-b border-slate-800">
144         <h1 className="text-lg sm:text-xl font-semibold">
145           Meus eventos
146         </h1>
147 
148         <div className="flex items-center gap-3">
149           <Link
150             href="/ingressos"
151             className="text-xs font-medium text-emerald-300 hover:text-emerald-200"
152           >
153             Meus ingressos
154           </Link>
155           <button
156             type="button"
157             className="text-xs font-medium text-slate-300 hover:text-slate-100"
158           >
159             Sair
160           </button>
161         </div>
162       </header>
163 
164       <main className="flex-1 px-4 py-6 sm:px-6 lg:px-8 max-w-5xl w-full mx-auto flex flex-col gap-6">
165         {/* Form de criação */}
166         <form
167           onSubmit={handleCreate}
168           className="flex flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-900/50 p-4 sm:flex-row sm:items-end sm:gap-4"
169         >
170           <div className="flex-1 flex flex-col gap-1">
171             <label className="text-xs font-medium text-slate-300">
172               Nome do evento
173             </label>
174             <input
175               type="text"
176               value={name}
177               onChange={(e) => setName(e.target.value)}
178               className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
179               placeholder="Digite o nome do evento"
180             />
181           </div>
182 
183           <div className="w-full sm:w-40 flex flex-col gap-1">
184             <label className="text-xs font-medium text-slate-300">
185               Tipo
186             </label>
187             <select
188               value={type}
189               onChange={(e) => setType(e.target.value as EventType)}
190               className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
191             >
192               <option value="FREE">Free</option>
193               <option value="PRE_PAGO">Pré pago</option>
194               <option value="POS_PAGO">Pós pago</option>
195             </select>
196           </div>
197 
198           <button
199             type="submit"
200             disabled={creating}
201             className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
202           >
203             {creating ? "Criando..." : "Adicionar evento"}
204           </button>
205         </form>
206 
207         {error && (
208           <p className="text-sm text-red-400">
209             {error}
210           </p>
211         )}
212 
213         {loading && (
214           <p className="text-sm text-slate-300">Carregando eventos...</p>
215         )}
216 
217         {!loading && events.length === 0 && (
218           <p className="text-sm text-slate-400">
219             Nenhum evento criado ainda. Crie o primeiro acima.
220           </p>
221         )}
222 
223         {/* Grid de cards */}
224         <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
225           {events.map((event) => (
226             <div
227               key={event.id}
228               onClick={() => router.push(getEventHref(event))}
229               className="flex flex-col gap-2 rounded-2xl border border-slate-800 bg-slate-900/60 p-4 cursor-pointer hover:border-emerald-500/70 hover:bg-slate-800/60 transition"
230             >
231               <div className="flex items-center justify-between gap-2">
232                 <span className="text-[11px] uppercase tracking-wide text-slate-400">
233                   {getTypeLabel(event.type)}
234                 </span>
235 
236                 <button
237                   type="button"
238                   onClick={(e) => {
239                     e.stopPropagation();
240                     const confirmed = window.confirm(
241                       "Deseja realmente excluir este evento? Essa ação não pode ser desfeita.",
242                     );
243                     if (!confirmed) return;
244                     void handleDelete(event.id);
245                   }}
246                   className="inline-flex items-center justify-center rounded-lg border border-red-600 px-2.5 py-1 text-[11px] font-medium text-red-400 hover:bg-red-950/50"
247                 >
248                   Excluir
249                 </button>
250               </div>
251 
252               <h2 className="text-sm font-semibold text-slate-50 line-clamp-2">
253                 {event.name}
254               </h2>
255             </div>
256           ))}
257         </div>
258       </main>
259     </div>
260   );
261 }

===== app/(app)/eventos/[id]/EventTipoClient.tsx =====
1 "use client";
2 
3 import { useEffect, useState } from "react";
4 import Link from "next/link";
5 import { useParams } from "next/navigation";
6 
7 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
8 
9 type Event = {
10   id: string;
11   name: string;
12   type: EventType;
13   description?: string | null;
14   location?: string | null;
15   inviteSlug?: string | null;
16   eventDate?: string | null; // ISO string
17   createdAt?: string;
18 };
19 
20 type Mode = "free" | "pre" | "pos";
21 
22 type Props = {
23   mode: Mode;
24 };
25 
26 function getTitle(mode: Mode) {
27   if (mode === "pre") return "Configurações do evento pré pago";
28   if (mode === "pos") return "Configurações do evento pós pago";
29   return "Configurações do evento free";
30 }
31 
32 function getIntro(mode: Mode) {
33   if (mode === "pre") {
34     return "Configure aqui os detalhes do evento pré pago e gere o link de checkout (pagamento antecipado).";
35   }
36   if (mode === "pos") {
37     return "Configure aqui os detalhes do evento pós pago.";
38   }
39   return "Configure aqui os detalhes do seu evento gratuito.";
40 }
41 
42 export default function EventTipoClient({ mode }: Props) {
43   const params = useParams() as { id?: string };
44   const eventId = String(params?.id ?? "").trim();
45 
46   const [event, setEvent] = useState<Event | null>(null);
47   const [loading, setLoading] = useState(true);
48   const [error, setError] = useState<string | null>(null);
49 
50   // campos do formulário (configurações básicas)
51   const [name, setName] = useState("");
52   const [eventDate, setEventDate] = useState(""); // YYYY-MM-DD
53   const [location, setLocation] = useState("");
54   const [description, setDescription] = useState("");
55   const [saving, setSaving] = useState(false);
56 
57   // checkout (pré-pago)
58   const [checkoutError, setCheckoutError] = useState<string | null>(null);
59   const [checkoutSuccess, setCheckoutSuccess] = useState<string | null>(null);
60   const [copyMessage, setCopyMessage] = useState<string | null>(null);
61   const [generatingCheckout, setGeneratingCheckout] = useState(false);
62 
63   useEffect(() => {
64     let active = true;
65 
66     async function load() {
67       try {
68         setLoading(true);
69         setError(null);
70         setCheckoutError(null);
71         setCheckoutSuccess(null);
72         setCopyMessage(null);
73 
74         console.log(
75           "[EventTipoClient] params.id:",
76           params?.id,
77           "eventId:",
78           eventId
79         );
80 
81         if (!eventId) {
82           setError("Evento não encontrado.");
83           setEvent(null);
84           return;
85         }
86 
87         console.log(
88           "[EventTipoClient] Carregando evento de /api/events/[id]..."
89         );
90         const res = await fetch(`/api/events/${eventId}`);
91 
92         if (!res.ok) {
93           const data = await res.json().catch(() => null);
94           if (!active) return;
95 
96           setError(data?.error ?? "Erro ao carregar evento.");
97           setEvent(null);
98           return;
99         }
100 
101         const data = (await res.json()) as Event;
102         if (!active) return;
103 
104         setEvent(data);
105         setName(data.name ?? "");
106         setLocation(data.location ?? "");
107         setDescription(data.description ?? "");
108 
109         if (data.eventDate) {
110           setEventDate(data.eventDate.slice(0, 10));
111         } else {
112           setEventDate("");
113         }
114       } catch (err) {
115         console.error("[EventTipoClient] Erro no fetch:", err);
116         if (!active) return;
117         setError("Erro inesperado ao carregar evento.");
118         setEvent(null);
119       } finally {
120         if (!active) return;
121         setLoading(false);
122       }
123     }
124 
125     load();
126 
127     return () => {
128       active = false;
129     };
130     // eslint-disable-next-line react-hooks/exhaustive-deps
131   }, [eventId, mode]);
132 
133   async function handleSave(e: React.FormEvent) {
134     e.preventDefault();
135 
136     if (!eventId) {
137       setError("Evento não encontrado.");
138       return;
139     }
140 
141     if (!name.trim()) {
142       setError("O nome do evento não pode ficar vazio.");
143       return;
144     }
145 
146     try {
147       setSaving(true);
148       setError(null);
149 
150       const res = await fetch("/api/events", {
151         method: "PATCH",
152         headers: {
153           "Content-Type": "application/json",
154         },
155         body: JSON.stringify({
156           id: eventId,
157           name: name.trim(),
158           description: description.trim() || null,
159           location: location.trim() || null,
160           eventDate: eventDate || null,
161         }),
162       });
163 
164       if (!res.ok) {
165         const data = await res.json().catch(() => null);
166         setError(data?.error ?? "Erro ao salvar alterações.");
167         return;
168       }
169 
170       const updated = (await res.json()) as Event;
171       setEvent(updated);
172     } catch (err) {
173       console.error("[EventTipoClient] Erro ao salvar evento:", err);
174       setError("Erro inesperado ao salvar alterações.");
175     } finally {
176       setSaving(false);
177     }
178   }
179 
180   async function handleGenerateCheckoutLink() {
181     if (!eventId) {
182       setCheckoutError("Evento não encontrado.");
183       return;
184     }
185 
186     try {
187       setGeneratingCheckout(true);
188       setCheckoutError(null);
189       setCheckoutSuccess(null);
190 
191       const randomPart = Math.random().toString(36).slice(2, 8);
192       const newSlug = `${eventId.slice(0, 6)}-${randomPart}`;
193 
194       const res = await fetch("/api/events", {
195         method: "PATCH",
196         headers: {
197           "Content-Type": "application/json",
198         },
199         body: JSON.stringify({
200           id: eventId,
201           inviteSlug: newSlug,
202         }),
203       });
204 
205       if (!res.ok) {
206         const data = await res.json().catch(() => null);
207         setCheckoutError(data?.error ?? "Erro ao gerar link de checkout.");
208         return;
209       }
210 
211       const updated = (await res.json()) as Event;
212       setEvent(updated);
213       setCheckoutSuccess("Link de checkout atualizado com sucesso.");
214     } catch (err) {
215       console.error("[EventTipoClient] Erro ao gerar link de checkout:", err);
216       setCheckoutError("Erro inesperado ao gerar link de checkout.");
217     } finally {
218       setGeneratingCheckout(false);
219     }
220   }
221 
222   async function handleCopyCheckoutLink() {
223     if (!event?.inviteSlug) {
224       setCopyMessage("Nenhum link gerado ainda para copiar.");
225       return;
226     }
227 
228     const path = `/checkout/${event.inviteSlug}`;
229     const fullUrl =
230       typeof window !== "undefined" ? `${window.location.origin}${path}` : path;
231 
232     try {
233       await navigator.clipboard.writeText(fullUrl);
234       setCopyMessage("Link de checkout copiado para a área de transferência.");
235       setTimeout(() => setCopyMessage(null), 3000);
236     } catch (err) {
237       console.error("[EventTipoClient] Erro ao copiar link de checkout:", err);
238       setCopyMessage(
239         `Não foi possível copiar automaticamente. Copie manualmente: ${fullUrl}`
240       );
241     }
242   }
243 
244   const checkoutPath =
245     event?.inviteSlug != null ? `/checkout/${event.inviteSlug}` : null;
246 
247   const hasLocation = location.trim().length > 0;
248   const encodedLocation = hasLocation
249     ? encodeURIComponent(location.trim())
250     : "";
251   const googleMapsUrl = hasLocation
252     ? `https://www.google.com/maps/search/?api=1&query=${encodedLocation}`
253     : "#";
254   const wazeUrl = hasLocation
255     ? `https://waze.com/ul?q=${encodedLocation}`
256     : "#";
257 
258   return (
259     <div className="min-h-screen bg-slate-950 text-slate-50 flex flex-col">
260       <header className="flex items-center justify-between px-6 py-4 border-b border-slate-800">
261         <Link
262           href="/dashboard/"
263           className="text-xs font-medium text-slate-300 hover:text-slate-100"
264         >
265           ← Voltar
266         </Link>
267 
268         {event && (
269           <span className="inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-[11px] font-medium uppercase tracking-wide text-slate-300 border border-slate-700">
270             {event.type}
271           </span>
272         )}
273       </header>
274 
275       <main className="flex-1 px-4 py-6 sm:px-6 lg:px-8 max-w-3xl w-full mx-auto flex flex-col gap-4">
276         {loading && (
277           <p className="text-sm text-slate-300">Carregando evento...</p>
278         )}
279 
280         {error && !loading && (
281           <p className="text-sm text-red-400">{error}</p>
282         )}
283 
284         {!loading && !error && !event && (
285           <p className="text-sm text-slate-300">Evento não encontrado.</p>
286         )}
287 
288         {event && (
289           <form
290             onSubmit={handleSave}
291             className="flex flex-col gap-4 rounded-2xl border border-slate-800 bg-slate-900/70 p-4 sm:p-6"
292           >
293             <div className="space-y-1">
294               <h1 className="text-xl sm:text-2xl font-semibold text-slate-50">
295                 {event.name}
296               </h1>
297               <h2 className="text-sm font-medium text-slate-200">
298                 {getTitle(mode)}
299               </h2>
300               <p className="text-sm text-slate-300">
301                 {getIntro(mode)}
302               </p>
303             </div>
304 
305             {/* Nome do evento */}
306             <div className="flex flex-col gap-1">
307               <label className="text-xs font-medium text-slate-300">
308                 Nome do evento
309               </label>
310               <input
311                 type="text"
312                 value={name}
313                 onChange={(e) => setName(e.target.value)}
314                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
315                 placeholder="Digite o nome do evento"
316               />
317             </div>
318 
319             {/* Data do evento */}
320             <div className="flex flex-col gap-1">
321               <label className="text-xs font-medium text-slate-300">
322                 Data do evento
323               </label>
324               <input
325                 type="date"
326                 value={eventDate}
327                 onChange={(e) => setEventDate(e.target.value)}
328                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
329               />
330               <p className="text-[10px] text-slate-500">
331                 Essa data será exibida junto com o evento nas páginas de convite.
332               </p>
333             </div>
334 
335             {/* Local do evento */}
336             <div className="flex flex-col gap-1">
337               <label className="text-xs font-medium text-slate-300">
338                 Local do evento
339               </label>
340               <input
341                 type="text"
342                 value={location}
343                 onChange={(e) => setLocation(e.target.value)}
344                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
345                 placeholder="Rua Nome da Rua, 123 - Bairro, Cidade - UF"
346               />
347               <p className="text-[10px] text-slate-500">
348                 Formato sugerido: &quot;Rua Nome da Rua, 123 - Bairro, Cidade - UF&quot;.
349                 Esse endereço será usado para abrir atalhos para Google Maps e Waze.
350               </p>
351             </div>
352 
353             {/* Como chegar ao local */}
354             {hasLocation && (
355               <div className="flex flex-col gap-2 rounded-xl border border-slate-800 bg-slate-950/60 p-3">
356                 <span className="text-xs font-medium text-slate-300">
357                   Como chegar ao local
358                 </span>
359                 <p className="text-[10px] text-slate-500">
360                   Use os atalhos abaixo para abrir o endereço direto no aplicativo de mapas.
361                 </p>
362                 <div className="flex flex-wrap gap-2">
363                   <a
364                     href={googleMapsUrl}
365                     target="_blank"
366                     rel="noreferrer"
367                     className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
368                   >
369                     Abrir no Google Maps
370                   </a>
371                   <a
372                     href={wazeUrl}
373                     target="_blank"
374                     rel="noreferrer"
375                     className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
376                   >
377                     Abrir no Waze
378                   </a>
379                 </div>
380               </div>
381             )}
382 
383             {/* Descrição do evento */}
384             <div className="flex flex-col gap-1">
385               <label className="text-xs font-medium text-slate-300">
386                 Descrição do evento
387               </label>
388               <textarea
389                 value={description}
390                 onChange={(e) => setDescription(e.target.value)}
391                 rows={4}
392                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 resize-y"
393                 placeholder="Detalhe regras de pagamento, política de reembolso, lotes, etc."
394               />
395             </div>
396 
397             {/* BLOCO DE CHECKOUT APENAS PARA PRÉ PAGO */}
398             {mode === "pre" && (
399               <section className="mt-2 flex flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
400                 <div className="flex flex-wrap items-center justify-between gap-2">
401                   <h3 className="text-xs font-semibold text-slate-200 uppercase tracking-wide">
402                     Link de checkout (pagamento antecipado)
403                   </h3>
404 
405                   {event.inviteSlug && (
406                     <span className="text-[11px] text-slate-400">
407                       Código do checkout:{" "}
408                       <span className="text-slate-200">
409                         {event.inviteSlug}
410                       </span>
411                     </span>
412                   )}
413                 </div>
414 
415                 <p className="text-[11px] text-slate-400">
416                   Gere o link de checkout e envie para os participantes.
417                   Eles irão para uma página onde preenchem seus dados
418                   e depois seguem para o pagamento (simulado por enquanto).
419                 </p>
420 
421                 <div className="flex flex-col gap-2">
422                   <div className="flex flex-wrap gap-2 mt-1">
423                     {/* Ver página de checkout (sempre aparece, mas pode ficar desabilitado) */}
424                     {checkoutPath ? (
425                       <Link
426                         href={checkoutPath}
427                         target="_blank"
428                         className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
429                       >
430                         Ver página de checkout
431                       </Link>
432                     ) : (
433                       <button
434                         type="button"
435                         disabled
436                         className="inline-flex items-center justify-center rounded-lg border border-slate-700 px-3 py-1.5 text-[11px] font-semibold text-slate-500 cursor-not-allowed"
437                       >
438                         Ver página de checkout
439                       </button>
440                     )}
441 
442                     {/* Copiar link */}
443                     <button
444                       type="button"
445                       disabled={!event.inviteSlug}
446                       onClick={handleCopyCheckoutLink}
447                       className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80 disabled:opacity-50"
448                     >
449                       Copiar link de checkout
450                     </button>
451 
452                     {/* Gerar novo link */}
453                     <button
454                       type="button"
455                       onClick={handleGenerateCheckoutLink}
456                       disabled={generatingCheckout}
457                       className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
458                     >
459                       {generatingCheckout
460                         ? "Gerando..."
461                         : "Gerar novo link de checkout"}
462                     </button>
463                   </div>
464 
465                   {checkoutPath && (
466                     <div className="mt-1">
467                       <p className="text-[11px] text-slate-400 mb-1">
468                         URL do checkout:
469                       </p>
470                       <code className="block w-full rounded-lg bg-slate-950 border border-slate-800 px-3 py-2 text-[11px] text-slate-100 break-all">
471                         {typeof window !== "undefined"
472                           ? `${window.location.origin}${checkoutPath}`
473                           : checkoutPath}
474                       </code>
475                     </div>
476                   )}
477                 </div>
478 
479                 {checkoutError && (
480                   <p className="text-[11px] text-red-400">
481                     {checkoutError}
482                   </p>
483                 )}
484 
485                 {checkoutSuccess && (
486                   <p className="text-[11px] text-emerald-400">
487                     {checkoutSuccess}
488                   </p>
489                 )}
490 
491                 {copyMessage && (
492                   <p className="text-[11px] text-emerald-300">
493                     {copyMessage}
494                   </p>
495                 )}
496               </section>
497             )}
498 
499             <div className="flex justify-end pt-2">
500               <button
501                 type="submit"
502                 disabled={saving}
503                 className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
504               >
505                 {saving ? "Salvando..." : "Salvar alterações"}
506               </button>
507             </div>
508           </form>
509         )}
510       </main>
511     </div>
512   );
513 }

===== app/(app)/eventos/[id]/pre/page.tsx =====
1 import PreEventClient from "../PreEventClient";
2 
3 export default function EventoPrePagoPage() {
4   return <PreEventClient />;
5 }

===== app/(app)/eventos/[id]/PreEventClient.tsx =====
1 /* eslint-disable react/no-unescaped-entities */
2 "use client";
3 
4 import { useEffect, useState } from "react";
5 import Link from "next/link";
6 import { useParams } from "next/navigation";
7 
8 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
9 
10 type Event = {
11   id: string;
12   name: string;
13   type: EventType;
14   description?: string | null;
15   location?: string | null;
16   eventDate?: string | null;
17   ticketPrice?: string | null;
18   paymentLink?: string | null;
19   salesStart?: string | null;
20   salesEnd?: string | null;
21   inviteSlug?: string | null;
22 };
23 
24 const APP_URL =
25   process.env.NEXT_PUBLIC_APP_URL && process.env.NEXT_PUBLIC_APP_URL.trim()
26     ? process.env.NEXT_PUBLIC_APP_URL.trim().replace(/\/$/, "")
27     : null;
28 
29 export default function PreEventClient() {
30   const params = useParams() as { id?: string };
31   const eventId = String(params?.id ?? "").trim();
32 
33   const [loading, setLoading] = useState(true);
34   const [saving, setSaving] = useState(false);
35 
36   const [error, setError] = useState<string | null>(null);
37   const [success, setSuccess] = useState<string | null>(null);
38 
39   // Campos do formulário
40   const [name, setName] = useState("");
41   const [eventDate, setEventDate] = useState(""); // "YYYY-MM-DD"
42   const [location, setLocation] = useState("");
43   const [description, setDescription] = useState("");
44   const [ticketPrice, setTicketPrice] = useState("");
45   const [paymentLink, setPaymentLink] = useState("");
46   const [salesStart, setSalesStart] = useState("");
47   const [salesEnd, setSalesEnd] = useState("");
48 
49   useEffect(() => {
50     let active = true;
51 
52     async function load() {
53       try {
54         setLoading(true);
55         setError(null);
56         setSuccess(null);
57 
58         if (!eventId) {
59           setError("Evento não encontrado.");
60           return;
61         }
62 
63         const res = await fetch(`/api/events/${eventId}`);
64         if (!res.ok) {
65           const data = await res.json().catch(() => null);
66           if (!active) return;
67           setError(data?.error ?? "Erro ao carregar evento.");
68           return;
69         }
70 
71         const found = (await res.json()) as Event;
72         if (!active) return;
73 
74         setName(found.name ?? "");
75         setDescription(found.description ?? "");
76         setLocation(found.location ?? "");
77         setTicketPrice(found.ticketPrice ?? "");
78 
79         if (found.eventDate) {
80           setEventDate(found.eventDate.slice(0, 10));
81         } else {
82           setEventDate("");
83         }
84 
85         if (found.salesStart) {
86           setSalesStart(found.salesStart.slice(0, 10));
87         } else {
88           setSalesStart("");
89         }
90 
91         if (found.salesEnd) {
92           setSalesEnd(found.salesEnd.slice(0, 10));
93         } else {
94           setSalesEnd("");
95         }
96 
97         // Monta o link de checkout automaticamente:
98         // prioridade:
99         // 1) paymentLink salvo no banco
100         // 2) se não tiver, usa inviteSlug -> /checkout/[slug]
101         if (found.paymentLink && found.paymentLink.trim()) {
102           setPaymentLink(found.paymentLink.trim());
103         } else if (found.inviteSlug && found.inviteSlug.trim()) {
104           const base =
105             APP_URL ??
106             (typeof window !== "undefined" ? window.location.origin : "");
107           const link = base
108             ? `${base.replace(/\/$/, "")}/checkout/${found.inviteSlug.trim()}`
109             : "";
110           setPaymentLink(link);
111         } else {
112           setPaymentLink("");
113         }
114       } catch (err) {
115         console.error("[PreEventClient] Erro no fetch:", err);
116         if (!active) return;
117         setError("Erro inesperado ao carregar evento.");
118       } finally {
119         if (!active) return;
120         setLoading(false);
121       }
122     }
123 
124     load();
125 
126     return () => {
127       active = false;
128     };
129   }, [eventId]);
130 
131   async function handleSave(e: React.FormEvent) {
132     e.preventDefault();
133     if (!eventId) {
134       setError("Evento não encontrado.");
135       return;
136     }
137 
138     if (!name.trim()) {
139       setError("O nome do evento não pode ficar vazio.");
140       setSuccess(null);
141       return;
142     }
143 
144     try {
145       setSaving(true);
146       setError(null);
147       setSuccess(null);
148 
149       const res = await fetch("/api/events", {
150         method: "PATCH",
151         headers: {
152           "Content-Type": "application/json",
153         },
154         body: JSON.stringify({
155           id: eventId,
156           name: name.trim(),
157           description: description.trim() || null,
158           location: location.trim() || null,
159           ticketPrice: ticketPrice.trim() || null,
160           paymentLink: paymentLink.trim() || null,
161           eventDate: eventDate || null,
162           salesStart: salesStart || null,
163           salesEnd: salesEnd || null,
164         }),
165       });
166 
167       if (!res.ok) {
168         const data = await res.json().catch(() => null);
169         setError(data?.error ?? "Erro ao salvar alterações.");
170         return;
171       }
172 
173       setSuccess("Alterações salvas com sucesso.");
174     } catch (err) {
175       console.error("[PreEventClient] Erro ao salvar:", err);
176       setError("Erro inesperado ao salvar alterações.");
177     } finally {
178       setSaving(false);
179     }
180   }
181 
182   const trimmedLocation = location.trim();
183   const hasLocation = trimmedLocation.length > 0;
184 
185   const googleMapsUrl = hasLocation
186     ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
187         trimmedLocation,
188       )}`
189     : null;
190 
191   const wazeUrl = hasLocation
192     ? `https://waze.com/ul?q=${encodeURIComponent(
193         trimmedLocation,
194       )}&navigate=yes`
195     : null;
196 
197   return (
198     <div className="min-h-screen bg-slate-950 text-slate-50 flex flex-col">
199       <header className="flex items-center justify-between px-6 py-4 border-b border-slate-800">
200         <Link
201           href="/dashboard/"
202           className="text-xs font-medium text-slate-300 hover:text-slate-100"
203         >
204           ← Voltar
205         </Link>
206 
207         <span className="inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-[11px] font-medium uppercase tracking-wide text-slate-300 border border-slate-700">
208           Evento pré pago
209         </span>
210       </header>
211 
212       <main className="flex-1 px-4 py-6 sm:px-6 lg:px-8 max-w-3xl w-full mx-auto flex flex-col gap-4">
213         {loading && (
214           <p className="text-sm text-slate-300">Carregando evento...</p>
215         )}
216 
217         {!loading && error && (
218           <p className="text-sm text-red-400">{error}</p>
219         )}
220 
221         {!loading && !error && (
222           <form
223             onSubmit={handleSave}
224             className="flex flex-col gap-4 rounded-2xl border border-slate-800 bg-slate-900/70 p-4 sm:p-6"
225           >
226             <h1 className="text-lg sm:text-xl font-semibold text-slate-50">
227               Configurações do evento pré pago
228             </h1>
229 
230             {success && (
231               <p className="text-xs text-emerald-400">
232                 {success}
233               </p>
234             )}
235 
236             {/* Nome */}
237             <div className="flex flex-col gap-1">
238               <label className="text-xs font-medium text-slate-300">
239                 Nome do evento
240               </label>
241               <input
242                 type="text"
243                 value={name}
244                 onChange={(e) => setName(e.target.value)}
245                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
246                 placeholder="Digite o nome do evento"
247               />
248             </div>
249 
250             {/* Data do evento */}
251             <div className="flex flex-col gap-1">
252               <label className="text-xs font-medium text-slate-300">
253                 Data do evento
254               </label>
255               <input
256                 type="date"
257                 value={eventDate}
258                 onChange={(e) => setEventDate(e.target.value)}
259                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
260               />
261               <p className="text-[10px] text-slate-500">
262                 Essa data é salva junto com o evento e pode aparecer nos convites.
263               </p>
264             </div>
265 
266             {/* Período de vendas */}
267             <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
268               <div className="flex flex-col gap-1">
269                 <label className="text-xs font-medium text-slate-300">
270                   Início das vendas
271                 </label>
272                 <input
273                   type="date"
274                   value={salesStart}
275                   onChange={(e) => setSalesStart(e.target.value)}
276                   className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
277                 />
278                 <p className="text-[10px] text-slate-500">
279                   Data a partir da qual você considera as vendas abertas.
280                 </p>
281               </div>
282 
283               <div className="flex flex-col gap-1">
284                 <label className="text-xs font-medium text-slate-300">
285                   Fim das vendas
286                 </label>
287                 <input
288                   type="date"
289                   value={salesEnd}
290                   onChange={(e) => setSalesEnd(e.target.value)}
291                   className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
292                 />
293                 <p className="text-[10px] text-slate-500">
294                   Data limite para a compra de ingressos (opcional).
295                 </p>
296               </div>
297             </div>
298 
299             {/* Local do evento */}
300             <div className="flex flex-col gap-1">
301               <label className="text-xs font-medium text-slate-300">
302                 Local do evento
303               </label>
304               <input
305                 type="text"
306                 value={location}
307                 onChange={(e) => setLocation(e.target.value)}
308                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
309                 placeholder="Ex.: Rua Nome da Rua, 123 - Bairro, Cidade - UF"
310               />
311               <p className="text-[10px] text-slate-500">
312                 Formato sugerido: "Rua Nome da Rua, 123 - Bairro, Cidade - UF".
313                 Ex.: "Rua Joaquim Nabuco, 100 - Centro, Criciúma - SC".
314               </p>
315               <p className="text-[10px] text-slate-500">
316                 Esse endereço será usado para gerar atalhos para Google Maps e Waze.
317               </p>
318             </div>
319 
320             {/* Atalhos de mapa (se tiver local) */}
321             {hasLocation && (
322               <div className="flex flex-col gap-2 rounded-xl border border-slate-800 bg-slate-950/60 p-3">
323                 <span className="text-xs font-medium text-slate-300">
324                   Como chegar ao local
325                 </span>
326                 <p className="text-[11px] text-slate-500">
327                   Use os atalhos abaixo para abrir o endereço direto no aplicativo de mapas.
328                 </p>
329 
330                 <div className="flex flex-wrap gap-2 mt-1">
331                   {googleMapsUrl && (
332                     <a
333                       href={googleMapsUrl}
334                       target="_blank"
335                       rel="noopener noreferrer"
336                       className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
337                     >
338                       Abrir no Google Maps
339                     </a>
340                   )}
341 
342                   {wazeUrl && (
343                     <a
344                       href={wazeUrl}
345                       target="_blank"
346                       rel="noopener noreferrer"
347                       className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
348                     >
349                       Abrir no Waze
350                     </a>
351                   )}
352                 </div>
353               </div>
354             )}
355 
356             {/* Valor do ingresso */}
357             <div className="flex flex-col gap-1">
358               <label className="text-xs font-medium text-slate-300">
359                 Valor do ingresso
360               </label>
361               <input
362                 type="text"
363                 value={ticketPrice}
364                 onChange={(e) => setTicketPrice(e.target.value)}
365                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
366                 placeholder='Ex.: "R$ 50,00" ou "R$ 30,00 meia, R$ 60,00 inteira"'
367               />
368               <p className="text-[10px] text-slate-500">
369                 Campo livre para você descrever valores (inteira, meia, lotes, etc).
370               </p>
371             </div>
372 
373             {/* Link de pagamento */}
374             <div className="flex flex-col gap-1">
375               <label className="text-xs font-medium text-slate-300">
376                 Link para pagamento / checkout
377               </label>
378               <input
379                 type="url"
380                 value={paymentLink}
381                 readOnly
382                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
383                 placeholder="O link será gerado automaticamente a partir do código de convite."
384               />
385               <p className="text-[10px] text-slate-500">
386                 Copie esse link e envie aos convidados para realizarem o checkout
387                 do ingresso.
388               </p>
389               {paymentLink && (
390                 <p className="text-[10px] text-emerald-400 break-all">
391                   {paymentLink}
392                 </p>
393               )}
394             </div>
395 
396             {/* Descrição */}
397             <div className="flex flex-col gap-1">
398               <label className="text-xs font-medium text-slate-300">
399                 Descrição do evento
400               </label>
401               <textarea
402                 value={description}
403                 onChange={(e) => setDescription(e.target.value)}
404                 rows={4}
405                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 resize-y"
406                 placeholder="Detalhe regras de pagamento, política de reembolso, lotes, etc."
407               />
408             </div>
409 
410             <div className="flex justify-end">
411               <button
412                 type="submit"
413                 disabled={saving}
414                 className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
415               >
416                 {saving ? "Salvando..." : "Salvar alterações"}
417               </button>
418             </div>
419           </form>
420         )}
421       </main>
422     </div>
423   );
424 }

===== app/(app)/eventos/[id]/free/page.tsx =====
1 import FreeEventClient from "../FreeEventClient";
2 
3 export default function EventoFreePage() {
4   return <FreeEventClient />;
5 }

===== app/(app)/eventos/[id]/FreeEventClient.tsx =====
1 /* eslint-disable react/no-unescaped-entities */
2 "use client";
3 
4 import { useEffect, useState } from "react";
5 import Link from "next/link";
6 import { useParams } from "next/navigation";
7 
8 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
9 
10 type Event = {
11   id: string;
12   name: string;
13   type: EventType;
14   description?: string | null;
15   location?: string | null;
16   inviteSlug?: string | null;
17   eventDate?: string | null; // ISO string
18   createdAt?: string;
19 };
20 
21 type Guest = {
22   id: string;
23   name: string;
24   slug: string;
25   confirmedAt?: string | null;
26 };
27 
28 export default function FreeEventClient() {
29   const params = useParams() as { id?: string };
30   const eventId = String(params?.id ?? "").trim();
31 
32   const [loading, setLoading] = useState(true);
33   const [saving, setSaving] = useState(false);
34   const [generatingLink, setGeneratingLink] = useState(false);
35 
36   const [error, setError] = useState<string | null>(null);
37   const [success, setSuccess] = useState<string | null>(null);
38 
39   // Campos do formulário
40   const [name, setName] = useState("");
41   const [eventDate, setEventDate] = useState(""); // "YYYY-MM-DD"
42   const [description, setDescription] = useState("");
43   const [location, setLocation] = useState("");
44   const [inviteSlug, setInviteSlug] = useState<string | null>(null);
45 
46   // Lista de convidados
47   const [guests, setGuests] = useState<Guest[]>([]);
48   const [loadingGuests, setLoadingGuests] = useState(false);
49   const [guestError, setGuestError] = useState<string | null>(null);
50   const [newGuestName, setNewGuestName] = useState("");
51   const [addingGuest, setAddingGuest] = useState(false);
52 
53   useEffect(() => {
54     let active = true;
55 
56     async function load() {
57       try {
58         setLoading(true);
59         setError(null);
60         setSuccess(null);
61 
62         if (!eventId) {
63           setError("Evento não encontrado.");
64           return;
65         }
66 
67         // Carrega evento pelo ID
68         const eventRes = await fetch(`/api/events/${eventId}`);
69         if (!eventRes.ok) {
70           const data = await eventRes.json().catch(() => null);
71           if (!active) return;
72           setError(data?.error ?? "Erro ao carregar evento.");
73           return;
74         }
75 
76         const found = (await eventRes.json()) as Event;
77         if (!active) return;
78 
79         setName(found.name ?? "");
80         setDescription(found.description ?? "");
81         setLocation(found.location ?? "");
82         setInviteSlug(found.inviteSlug ?? null);
83 
84         if (found.eventDate) {
85           const onlyDate = found.eventDate.slice(0, 10);
86           setEventDate(onlyDate);
87         } else {
88           setEventDate("");
89         }
90 
91         // Carrega convidados
92         setLoadingGuests(true);
93         setGuestError(null);
94 
95         const guestsRes = await fetch(`/api/events/${eventId}/guests`);
96         if (!guestsRes.ok) {
97           const data = await guestsRes.json().catch(() => null);
98           if (!active) return;
99           setGuestError(
100             data?.error ?? "Erro ao carregar lista de convidados."
101           );
102         } else {
103           const data = (await guestsRes.json()) as { guests?: Guest[] };
104           if (!active) return;
105           setGuests(data.guests ?? []);
106         }
107       } catch (err) {
108         console.error("[FreeEventClient] Erro no fetch:", err);
109         if (!active) return;
110         setError("Erro inesperado ao carregar evento.");
111       } finally {
112         if (!active) return;
113         setLoading(false);
114         setLoadingGuests(false);
115       }
116     }
117 
118     load();
119 
120     return () => {
121       active = false;
122     };
123   }, [eventId]);
124 
125   async function handleSave(e: React.FormEvent) {
126     e.preventDefault();
127     if (!eventId) {
128       setError("Evento não encontrado.");
129       return;
130     }
131 
132     if (!name.trim()) {
133       setError("O nome do evento não pode ficar vazio.");
134       setSuccess(null);
135       return;
136     }
137 
138     try {
139       setSaving(true);
140       setError(null);
141       setSuccess(null);
142 
143       const res = await fetch("/api/events", {
144         method: "PATCH",
145         headers: {
146           "Content-Type": "application/json",
147         },
148         body: JSON.stringify({
149           id: eventId,
150           name: name.trim(),
151           description: description.trim() || null,
152           location: location.trim() || null,
153           eventDate: eventDate || null,
154         }),
155       });
156 
157       if (!res.ok) {
158         const data = await res.json().catch(() => null);
159         setError(data?.error ?? "Erro ao salvar alterações.");
160         return;
161       }
162 
163       setSuccess("Alterações salvas com sucesso.");
164     } catch (err) {
165       console.error("[FreeEventClient] Erro ao salvar:", err);
166       setError("Erro inesperado ao salvar alterações.");
167     } finally {
168       setSaving(false);
169     }
170   }
171 
172   async function handleGenerateInviteLink() {
173     if (!eventId) {
174       setError("Evento não encontrado.");
175       return;
176     }
177 
178     try {
179       setGeneratingLink(true);
180       setError(null);
181       setSuccess(null);
182 
183       const randomPart = Math.random().toString(36).slice(2, 8);
184       const newSlug = `${eventId.slice(0, 6)}-${randomPart}`;
185 
186       const res = await fetch("/api/events", {
187         method: "PATCH",
188         headers: {
189           "Content-Type": "application/json",
190         },
191         body: JSON.stringify({
192           id: eventId,
193           inviteSlug: newSlug,
194         }),
195       });
196 
197       if (!res.ok) {
198         const data = await res.json().catch(() => null);
199         setError(data?.error ?? "Erro ao gerar link de convite.");
200         return;
201       }
202 
203       setInviteSlug(newSlug);
204       setSuccess("Link de convite atualizado com sucesso.");
205     } catch (err) {
206       console.error("[FreeEventClient] Erro ao gerar link:", err);
207       setError("Erro inesperado ao gerar link de convite.");
208     } finally {
209       setGeneratingLink(false);
210     }
211   }
212 
213   // agora não é mais submit de form, é uma ação disparada pelo botão
214   async function handleAddGuest() {
215     if (!eventId) {
216       setGuestError("Evento não encontrado.");
217       return;
218     }
219 
220     const trimmed = newGuestName.trim();
221     if (!trimmed) {
222       setGuestError("Digite o nome do convidado antes de adicionar.");
223       return;
224     }
225 
226     try {
227       setAddingGuest(true);
228       setGuestError(null);
229 
230       const res = await fetch(`/api/events/${eventId}/guests`, {
231         method: "POST",
232         headers: {
233           "Content-Type": "application/json",
234         },
235         body: JSON.stringify({ name: trimmed }),
236       });
237 
238       if (!res.ok) {
239         const data = await res.json().catch(() => null);
240         setGuestError(data?.error ?? "Erro ao adicionar convidado.");
241         return;
242       }
243 
244       const created = (await res.json()) as Guest;
245 
246       setGuests((prev) => [...prev, created]);
247       setNewGuestName("");
248     } catch (err) {
249       console.error("[FreeEventClient] Erro ao adicionar convidado:", err);
250       setGuestError("Erro inesperado ao adicionar convidado.");
251     } finally {
252       setAddingGuest(false);
253     }
254   }
255 
256   const invitePath = inviteSlug ? `/convite/${inviteSlug}` : null;
257   const confirmedListPath = eventId ? `/eventos/${eventId}/confirmados` : null;
258 
259   // Localização e links de mapa
260   const trimmedLocation = location.trim();
261   const hasLocation = trimmedLocation.length > 0;
262 
263   const googleMapsUrl = hasLocation
264     ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
265         trimmedLocation,
266       )}`
267     : null;
268 
269   const wazeUrl = hasLocation
270     ? `https://waze.com/ul?q=${encodeURIComponent(
271         trimmedLocation,
272       )}&navigate=yes`
273     : null;
274 
275   // Ordena convidados por nome
276   const sortedGuests = [...guests].sort((a, b) =>
277     a.name.localeCompare(b.name, "pt-BR", { sensitivity: "base" })
278   );
279 
280   return (
281     <div className="min-h-screen bg-slate-950 text-slate-50 flex flex-col">
282       <header className="flex items-center justify-between px-6 py-4 border-b border-slate-800">
283         <Link
284           href="/dashboard/"
285           className="text-xs font-medium text-slate-300 hover:text-slate-100"
286         >
287           ← Voltar
288         </Link>
289 
290         <span className="inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-[11px] font-medium uppercase tracking-wide text-slate-300 border border-slate-700">
291           Evento free
292         </span>
293       </header>
294 
295       <main className="flex-1 px-4 py-6 sm:px-6 lg:px-8 max-w-3xl w-full mx-auto flex flex-col gap-4">
296         {loading && (
297           <p className="text-sm text-slate-300">Carregando evento...</p>
298         )}
299 
300         {!loading && error && (
301           <p className="text-sm text-red-400">{error}</p>
302         )}
303 
304         {!loading && !error && (
305           <form
306             onSubmit={handleSave}
307             className="flex flex-col gap-4 rounded-2xl border border-slate-800 bg-slate-900/70 p-4 sm:p-6"
308           >
309             <h1 className="text-lg sm:text-xl font-semibold text-slate-50">
310               Configurações do evento free
311             </h1>
312 
313             {success && (
314               <p className="text-xs text-emerald-400">
315                 {success}
316               </p>
317             )}
318 
319             {/* Nome */}
320             <div className="flex flex-col gap-1">
321               <label className="text-xs font-medium text-slate-300">
322                 Nome do evento
323               </label>
324               <input
325                 type="text"
326                 value={name}
327                 onChange={(e) => setName(e.target.value)}
328                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
329                 placeholder="Digite o nome do evento"
330               />
331             </div>
332 
333             {/* Data do evento */}
334             <div className="flex flex-col gap-1">
335               <label className="text-xs font-medium text-slate-300">
336                 Data do evento
337               </label>
338               <input
339                 type="date"
340                 value={eventDate}
341                 onChange={(e) => setEventDate(e.target.value)}
342                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
343               />
344               <p className="text-[10px] text-slate-500">
345                 Essa data é salva junto com o evento.
346               </p>
347             </div>
348 
349             {/* Local do evento */}
350             <div className="flex flex-col gap-1">
351               <label className="text-xs font-medium text-slate-300">
352                 Local do evento
353               </label>
354               <input
355                 type="text"
356                 value={location}
357                 onChange={(e) => setLocation(e.target.value)}
358                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
359                 placeholder="Ex.: Rua Nome da Rua, 123 - Bairro, Cidade - UF"
360               />
361               <p className="text-[10px] text-slate-500">
362                 Formato sugerido: "Rua Nome da Rua, 123 - Bairro, Cidade - UF".
363               </p>
364               <p className="text-[10px] text-slate-500">
365                 Esse endereço será usado para gerar atalhos para Google Maps e Waze.
366                 Evite abreviações muito fora do padrão para não confundir o mapa.
367               </p>
368             </div>
369 
370             {/* Descrição */}
371             <div className="flex flex-col gap-1">
372               <label className="text-xs font-medium text-slate-300">
373                 Descrição do evento
374               </label>
375               <textarea
376                 value={description}
377                 onChange={(e) => setDescription(e.target.value)}
378                 rows={4}
379                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 resize-y"
380                 placeholder="Descreva brevemente o evento, público alvo, regras, etc."
381               />
382             </div>
383 
384             {/* Atalhos de mapa (somente se tiver localização) */}
385             {hasLocation && (
386               <div className="flex flex-col gap-2 rounded-xl border border-slate-800 bg-slate-950/60 p-3">
387                 <span className="text-xs font-medium text-slate-300">
388                   Como chegar ao local
389                 </span>
390                 <p className="text-[11px] text-slate-500">
391                   Use os atalhos abaixo para abrir o endereço direto no aplicativo de mapas
392                   do celular ou no navegador.
393                 </p>
394 
395                 <div className="flex flex-wrap gap-2 mt-1">
396                   {googleMapsUrl && (
397                     <a
398                       href={googleMapsUrl}
399                       target="_blank"
400                       rel="noopener noreferrer"
401                       className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
402                     >
403                       Abrir no Google Maps
404                     </a>
405                   )}
406 
407                   {wazeUrl && (
408                     <a
409                       href={wazeUrl}
410                       target="_blank"
411                       rel="noopener noreferrer"
412                       className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
413                     >
414                       Abrir no Waze
415                     </a>
416                   )}
417                 </div>
418               </div>
419             )}
420 
421             {/* Link para convite aberto */}
422             <div className="flex flex-col gap-2 rounded-xl border border-slate-800 bg-slate-950/60 p-3">
423               <div className="flex items-center justify-between gap-2">
424                 <span className="text-xs font-medium text-slate-300">
425                   Link de convite aberto
426                 </span>
427 
428                 <button
429                   type="button"
430                   disabled={generatingLink}
431                   onClick={handleGenerateInviteLink}
432                   className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
433                 >
434                   {generatingLink
435                     ? "Gerando..."
436                     : inviteSlug
437                     ? "Gerar novo link"
438                     : "Gerar link de convite"}
439                 </button>
440               </div>
441 
442               {inviteSlug && invitePath && (
443                 <div className="flex flex-col gap-1">
444                   <Link
445                     href={invitePath}
446                     className="truncate text-xs text-emerald-400 hover:text-emerald-300 underline-offset-2 hover:underline"
447                   >
448                     {invitePath}
449                   </Link>
450                   <p className="text-[10px] text-slate-500">
451                     Esse link abre a tela de confirmação genérica. Qualquer
452                     pessoa com o link pode confirmar presença.
453                   </p>
454                 </div>
455               )}
456 
457               {!inviteSlug && (
458                 <p className="text-[11px] text-slate-500">
459                   Nenhum link gerado ainda. Clique em &quot;Gerar link de
460                   convite&quot; para criar um link único deste evento.
461                 </p>
462               )}
463             </div>
464 
465             {/* Lista de confirmados (link aberto) */}
466             <div className="flex flex-col gap-2 rounded-xl border border-slate-800 bg-slate-950/60 p-3">
467               <div className="flex items-center justify-between gap-2">
468                 <span className="text-xs font-medium text-slate-300">
469                   Lista de confirmados (link aberto)
470                 </span>
471 
472                 {confirmedListPath && (
473                   <Link
474                     href={confirmedListPath}
475                     className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
476                   >
477                     Ver lista
478                   </Link>
479                 )}
480               </div>
481               <p className="text-[11px] text-slate-400">
482                 Essa lista mostra todas as pessoas que confirmaram presença a
483                 partir do link aberto de convite.
484               </p>
485             </div>
486 
487             {/* Lista de convidados nomeados */}
488             <div className="flex flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-950/80 p-3 sm:p-4">
489               <div className="flex items-center justify-between gap-2">
490                 <h2 className="text-sm font-semibold text-slate-50">
491                   Lista de convidados
492                 </h2>
493                 {loadingGuests && (
494                   <span className="text-[11px] text-slate-400">
495                     Carregando convidados...
496                   </span>
497                 )}
498               </div>
499 
500               {/* Campo para adicionar convidado (sem form aninhado) */}
501               <div className="flex flex-col sm:flex-row gap-2">
502                 <input
503                   type="text"
504                   value={newGuestName}
505                   onChange={(e) => setNewGuestName(e.target.value)}
506                   onKeyDown={(e) => {
507                     if (e.key === "Enter") {
508                       e.preventDefault();
509                       handleAddGuest();
510                     }
511                   }}
512                   className="flex-1 rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
513                   placeholder="Nome do convidado (ex: João Silva)"
514                   disabled={addingGuest}
515                 />
516                 <button
517                   type="button"
518                   disabled={addingGuest}
519                   onClick={handleAddGuest}
520                   className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
521                 >
522                   {addingGuest ? "Adicionando..." : "Adicionar convidado"}
523                 </button>
524               </div>
525 
526               {/* Mensagens logo abaixo do campo */}
527               {guestError && (
528                 <p className="text-[11px] text-red-400">
529                   {guestError}
530                 </p>
531               )}
532 
533               {!loadingGuests && !sortedGuests.length && !guestError && (
534                 <p className="text-[11px] text-slate-500">
535                   Nenhum convidado adicionado ainda. Comece adicionando nomes
536                   acima para gerar links de convite individuais.
537                 </p>
538               )}
539 
540               {/* Lista em ordem alfabética */}
541               {sortedGuests.length > 0 && (
542                 <div className="mt-1 space-y-2">
543                   <p className="text-[11px] text-slate-400">
544                     Os convidados abaixo estão ordenados por nome. Quem ainda
545                     não confirmou tem um link exclusivo de convite.
546                   </p>
547 
548                   <ul className="divide-y divide-slate-800">
549                     {sortedGuests.map((guest, index) => {
550                       const guestPath = guest.slug
551                         ? `/convite/pessoa/${guest.slug}`
552                         : null;
553                       const isConfirmed = !!guest.confirmedAt;
554 
555                       return (
556                         <li
557                           key={guest.id}
558                           className="py-2 flex flex-col gap-1"
559                         >
560                           <div className="flex items-center justify-between gap-2">
561                             <div className="flex items-center gap-3">
562                               <span className="w-6 text-[11px] text-slate-500">
563                                 #{index + 1}
564                               </span>
565                               <span className="text-sm text-slate-50">
566                                 {guest.name}
567                               </span>
568                             </div>
569                             <span className="text-[11px]">
570                               {isConfirmed ? (
571                                 <span className="text-emerald-400">
572                                   Confirmado
573                                 </span>
574                               ) : (
575                                 <span className="text-slate-400">
576                                   Pendente
577                                 </span>
578                               )}
579                             </span>
580                           </div>
581 
582                           {/* Link só para quem ainda não confirmou */}
583                           {!isConfirmed && guestPath && (
584                             <Link
585                               href={guestPath}
586                               className="text-[11px] text-emerald-400 hover:text-emerald-300 underline-offset-2 hover:underline break-all"
587                             >
588                               {guestPath}
589                             </Link>
590                           )}
591                         </li>
592                       );
593                     })}
594                   </ul>
595                 </div>
596               )}
597             </div>
598 
599             <div className="flex justify-end">
600               <button
601                 type="submit"
602                 disabled={saving}
603                 className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
604               >
605                 {saving ? "Salvando..." : "Salvar alterações"}
606               </button>
607             </div>
608           </form>
609         )}
610       </main>
611     </div>
612   );
613 }

===== app/(app)/checkout/[slug]/page.tsx =====
1 import CheckoutClient from "./CheckoutClient";
2 import { MercadoPagoProvider } from "@/components/MercadoPagoProvider";
3 
4 export default function CheckoutPage() {
5   return (
6     <MercadoPagoProvider>
7       <CheckoutClient />
8     </MercadoPagoProvider>
9   );
10 }

===== app/(app)/checkout/[slug]/CheckoutClient.tsx =====
1 /* eslint-disable @typescript-eslint/no-explicit-any */
2 "use client";
3 
4 import { useEffect, useState } from "react";
5 import { useParams } from "next/navigation";
6 
7 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
8 
9 type CheckoutEvent = {
10   id: string;
11   name: string;
12   type: EventType;
13   description?: string | null;
14   location?: string | null;
15   eventDate?: string | null;
16   ticketPrice?: number | null;
17 };
18 
19 type CheckoutData = {
20   checkoutId: string;
21   event: CheckoutEvent;
22   amount: number;
23   currency: string;
24 };
25 
26 type PaymentMethodsCustomization = {
27   creditCard?: "all" | string[];
28   bankTransfer?: "all" | string[]; // Pix
29 };
30 
31 type PaymentBrickCustomization = {
32   paymentMethods: PaymentMethodsCustomization;
33   visual?: {
34     style?: {
35       theme?: "default" | "dark" | "bootstrap" | "flat" | "sharp";
36     };
37   };
38 };
39 
40 type BrickPayer = {
41   email: string;
42   identification?: {
43     type: string;
44     number: string;
45   };
46 };
47 
48 type BrickFormData = {
49   token: string;
50   payment_method_id: string;
51   issuer_id?: string;
52   installments: number;
53   payer: BrickPayer;
54 };
55 
56 type PaymentOnSubmitArgs = {
57   selectedPaymentMethod: string;
58   formData: BrickFormData;
59 };
60 
61 declare global {
62   interface Window {
63     MercadoPago: new (
64       publicKey: string,
65       options?: { locale?: string }
66     ) => {
67       bricks: () => {
68         create: (
69           name: string,
70           containerId: string,
71           options: {
72             initialization: { amount: number };
73             customization: PaymentBrickCustomization;
74             callbacks: {
75               onReady?: () => void;
76               onError?: (error: unknown) => void;
77               onSubmit: (args: PaymentOnSubmitArgs) => Promise<void>;
78             };
79           }
80         ) => Promise<void>;
81       };
82     };
83   }
84 }
85 
86 export default function CheckoutClient() {
87   const params = useParams() as { slug?: string };
88   const slug = String(params.slug ?? "").trim();
89 
90   const [checkout, setCheckout] = useState<CheckoutData | null>(null);
91   const [loading, setLoading] = useState(true);
92   const [processing, setProcessing] = useState(false);
93   const [error, setError] = useState<string | null>(null);
94 
95   // Carrega dados do checkout/evento pelo slug
96   useEffect(() => {
97     if (!slug) return;
98 
99     let cancelled = false;
100 
101     async function loadCheckout() {
102       try {
103         setLoading(true);
104         setError(null);
105 
106         const res = await fetch(`/api/payments/preferences/${slug}`);
107         if (!res.ok) {
108           throw new Error("Falha ao carregar dados do checkout.");
109         }
110 
111         const data = (await res.json()) as CheckoutData;
112         if (cancelled) return;
113 
114         setCheckout(data);
115       } catch (err) {
116         console.error(err);
117         if (!cancelled) {
118           setError("Erro ao carregar os dados do checkout.");
119         }
120       } finally {
121         if (!cancelled) {
122           setLoading(false);
123         }
124       }
125     }
126 
127     void loadCheckout();
128 
129     return () => {
130       cancelled = true;
131     };
132   }, [slug]);
133 
134   // Inicializa o Payment Brick (tema escuro, apenas cartão + Pix)
135   useEffect(() => {
136     if (!checkout) return;
137     if (typeof window === "undefined") return;
138 
139     const scriptId = "mp-bricks-script";
140     const containerId = "paymentBrick_container";
141 
142     const paymentCustomization: PaymentBrickCustomization = {
143       // Só cartão de crédito e Pix (bankTransfer)
144       paymentMethods: {
145         creditCard: "all",
146         bankTransfer: "all",
147       },
148       visual: {
149         style: {
150           theme: "dark",
151         },
152       },
153     };
154 
155     const initializeBrick = async () => {
156       try {
157         if (!window.MercadoPago) {
158           throw new Error("SDK do Mercado Pago não foi carregado.");
159         }
160 
161         const publicKey = process.env.NEXT_PUBLIC_MP_PUBLIC_KEY;
162         if (!publicKey) {
163           throw new Error("NEXT_PUBLIC_MP_PUBLIC_KEY não configurada.");
164         }
165 
166         const mp = new window.MercadoPago(publicKey, {
167           locale: "pt-BR",
168         });
169 
170         const bricksBuilder = mp.bricks();
171 
172         // Limpa o container antes de recriar o Brick
173         const container = document.getElementById(containerId);
174         if (container) {
175           container.innerHTML = "";
176         }
177 
178         await bricksBuilder.create("payment", containerId, {
179           initialization: {
180             amount: checkout.amount,
181           },
182           customization: paymentCustomization,
183           callbacks: {
184             onReady: () => {
185               // Brick pronto
186             },
187             onError: (err: unknown) => {
188               console.error("[PaymentBrick] erro:", err);
189               setError(
190                 "Erro ao carregar os meios de pagamento. Tente novamente em alguns instantes."
191               );
192             },
193             onSubmit: async ({
194               formData,
195               selectedPaymentMethod,
196             }: PaymentOnSubmitArgs) => {
197               // ⚠️ Garantir que temos checkoutId / eventId
198               if (!checkout) {
199                 setError(
200                   "Dados do checkout não foram carregados. Recarregue a página e tente novamente."
201                 );
202                 return;
203               }
204 
205               try {
206                 setProcessing(true);
207                 setError(null);
208 
209                 const {
210                   token,
211                   payment_method_id,
212                   issuer_id,
213                   installments,
214                   payer,
215                 } = formData;
216 
217                 const res = await fetch("/api/payments/process", {
218                   method: "POST",
219                   headers: {
220                     "Content-Type": "application/json",
221                     "X-Idempotency-Key": crypto.randomUUID(),
222                   },
223                   body: JSON.stringify({
224                     token,
225                     payment_method_id,
226                     issuer_id,
227                     installments,
228                     transaction_amount: checkout.amount,
229                     description: checkout.event.name,
230                     payer,
231                     selectedPaymentMethod,
232                     // ✅ campos novos obrigatórios para vincular pagamento → evento
233                     checkoutId: checkout.checkoutId,
234                     eventId: checkout.event.id,
235                   }),
236                 });
237 
238                 if (!res.ok) {
239                   let message =
240                     "Erro ao processar pagamento no Mercado Pago.";
241                   try {
242                     const body = (await res.json()) as {
243                       message?: string;
244                       error?: string;
245                     };
246                     message = body.message ?? body.error ?? message;
247                   } catch {
248                     // ignore parse error
249                   }
250                   throw new Error(message);
251                 }
252 
253                 const result = await res.json();
254 
255                 console.log("Pagamento aprovado/pendente:", result);
256                 window.alert(
257                   "Pagamento processado com sucesso ou em análise."
258                 );
259                 window.location.reload();
260               } catch (err) {
261                 console.error(err);
262                 const message =
263                   err instanceof Error
264                     ? err.message
265                     : "Erro ao processar pagamento.";
266                 setError(message);
267               } finally {
268                 setProcessing(false);
269               }
270             },
271           },
272         });
273       } catch (err) {
274         console.error(err);
275         setError(
276           "Não foi possível inicializar o pagamento. Tente novamente em alguns instantes."
277         );
278       }
279     };
280 
281     let script = document.getElementById(scriptId) as HTMLScriptElement | null;
282 
283     const handleLoad = () => {
284       void initializeBrick();
285     };
286 
287     if (script && (window as any).MercadoPago) {
288       void initializeBrick();
289     } else {
290       if (!script) {
291         script = document.createElement("script");
292         script.id = scriptId;
293         script.src = "https://sdk.mercadopago.com/js/v2";
294         script.async = true;
295         document.body.appendChild(script);
296       }
297       script.addEventListener("load", handleLoad);
298     }
299 
300     return () => {
301       if (script) {
302         script.removeEventListener("load", handleLoad);
303       }
304     };
305   }, [checkout]);
306 
307   if (loading) {
308     return (
309       <div className="min-h-screen flex items-center justify-center bg-slate-950 text-slate-50">
310         <div className="text-sm text-slate-300">
311           Carregando dados do checkout...
312         </div>
313       </div>
314     );
315   }
316 
317   if (error) {
318     return (
319       <div className="min-h-screen flex items-center justify-center bg-slate-950 text-slate-50">
320         <div className="max-w-md rounded-xl border border-red-500/40 bg-red-950/40 p-4 text-sm">
321           <p className="font-semibold mb-1">Ops, algo deu errado</p>
322           <p>{error}</p>
323         </div>
324       </div>
325     );
326   }
327 
328   if (!checkout) {
329     return (
330       <div className="min-h-screen flex items-center justify-center bg-slate-950 text-slate-50">
331         <div className="text-sm text-red-400">Checkout não encontrado.</div>
332       </div>
333     );
334   }
335 
336   const { event } = checkout;
337 
338   return (
339     <div className="min-h-screen flex items-center justify-center bg-slate-950 text-slate-50">
340       <div className="w-full max-w-md rounded-2xl border border-slate-800 bg-slate-900/80 p-4 shadow-xl">
341         <header className="mb-4 space-y-1">
342           <p className="text-xs uppercase tracking-wide text-slate-400">
343             Pagamento seguro com Mercado Pago
344           </p>
345           <h1 className="text-lg font-semibold">{event.name}</h1>
346           <p className="text-sm text-slate-300">
347             Valor:{" "}
348             <span className="font-semibold">
349               {checkout.amount.toLocaleString("pt-BR", {
350                 style: "currency",
351                 currency: checkout.currency,
352               })}
353             </span>
354           </p>
355           {event.location && (
356             <p className="text-xs text-slate-400">{event.location}</p>
357           )}
358         </header>
359 
360         <div id="paymentBrick_container" />
361 
362         {processing && (
363           <p className="mt-3 text-xs text-slate-400">
364             Processando pagamento, não feche esta página...
365           </p>
366         )}
367       </div>
368     </div>
369   );
370 }

===== app/(app)/convite/[slug]/page.tsx =====
1 import ConviteClient from "./ConviteClient";
2 
3 type PageProps = {
4   params: {
5     slug: string;
6   };
7 };
8 
9 export default function ConvitePage({ params }: PageProps) {
10   return <ConviteClient slug={params.slug} />;
11 }

===== app/(app)/convite/[slug]/ConviteClient.tsx =====
1 "use client";
2 
3 import { useEffect, useState } from "react";
4 import { useParams } from "next/navigation";
5 
6 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
7 
8 type Event = {
9   id: string;
10   name: string;
11   type: EventType;
12   description?: string | null;
13   location?: string | null;
14   eventDate?: string | null; // ISO string
15   ticketPrice?: string | null;
16   paymentLink?: string | null;
17   inviteSlug?: string | null;
18 };
19 
20 type Props = {
21   slug: string;
22 };
23 
24 function formatDate(iso?: string | null) {
25   if (!iso) return null;
26   const d = new Date(iso);
27   if (Number.isNaN(d.getTime())) return null;
28 
29   const dia = String(d.getUTCDate()).padStart(2, "0");
30   const mes = String(d.getUTCMonth() + 1).padStart(2, "0");
31   const ano = d.getUTCFullYear();
32   return `${dia}/${mes}/${ano}`;
33 }
34 
35 export default function ConviteClient({ slug }: Props) {
36   const params = useParams() as { slug?: string };
37   const effectiveSlug = String(params?.slug ?? slug ?? "").trim();
38 
39   const [event, setEvent] = useState<Event | null>(null);
40   const [loadingEvent, setLoadingEvent] = useState(true);
41   const [eventError, setEventError] = useState<string | null>(null);
42 
43   const [name, setName] = useState("");
44   const [confirmedName, setConfirmedName] = useState<string | null>(null);
45   const [formError, setFormError] = useState<string | null>(null);
46   const [confirming, setConfirming] = useState(false);
47 
48   useEffect(() => {
49     let active = true;
50 
51     async function loadEvent() {
52       try {
53         setLoadingEvent(true);
54         setEventError(null);
55         setEvent(null);
56 
57         console.log(
58           "[ConviteClient] slug props:",
59           slug,
60           "params.slug:",
61           params?.slug,
62           "effectiveSlug:",
63           effectiveSlug,
64         );
65 
66         if (!effectiveSlug) {
67           setEventError("Código de convite inválido.");
68           return;
69         }
70 
71         const res = await fetch(
72           `/api/events/by-invite/${encodeURIComponent(effectiveSlug)}`,
73         );
74 
75         if (!res.ok) {
76           const data = await res.json().catch(() => null);
77           if (!active) return;
78 
79           if (res.status === 404) {
80             setEventError("Nenhum evento encontrado para este convite.");
81           } else {
82             setEventError(
83               data?.error ?? "Erro ao carregar informações do evento.",
84             );
85           }
86           return;
87         }
88 
89         const data = (await res.json()) as Event;
90         if (!active) return;
91 
92         setEvent(data);
93       } catch (err) {
94         console.error("[ConviteClient] Erro ao carregar evento:", err);
95         if (!active) return;
96         setEventError("Erro inesperado ao carregar informações do evento.");
97       } finally {
98         if (!active) return;
99         setLoadingEvent(false);
100       }
101     }
102 
103     void loadEvent();
104 
105     return () => {
106       active = false;
107     };
108     // eslint-disable-next-line react-hooks/exhaustive-deps
109   }, [effectiveSlug]);
110 
111   async function handleSubmit(e: React.FormEvent) {
112     e.preventDefault();
113 
114     const trimmed = name.trim();
115     if (!trimmed) {
116       setFormError("Por favor, digite seu nome para confirmar a presença.");
117       setConfirmedName(null);
118       return;
119     }
120 
121     if (!event || !event.id) {
122       setFormError(
123         "Ainda não foi possível identificar o evento deste convite. Tente novamente em alguns segundos.",
124       );
125       setConfirmedName(null);
126       return;
127     }
128 
129     try {
130       setConfirming(true);
131       setFormError(null);
132 
133       const res = await fetch(`/api/events/${event.id}/confirmados`, {
134         method: "POST",
135         headers: {
136           "Content-Type": "application/json",
137         },
138         body: JSON.stringify({
139           name: trimmed,
140         }),
141       });
142 
143       if (!res.ok) {
144         const data = await res.json().catch(() => null);
145         setFormError(
146           data?.error ?? "Erro ao registrar a confirmação de presença.",
147         );
148         setConfirmedName(null);
149         return;
150       }
151 
152       setConfirmedName(trimmed);
153     } catch (err) {
154       console.error("[ConviteClient] Erro ao confirmar presença:", err);
155       setFormError(
156         "Erro inesperado ao registrar a confirmação. Tente novamente.",
157       );
158       setConfirmedName(null);
159     } finally {
160       setConfirming(false);
161     }
162   }
163 
164   const formattedDate = formatDate(event?.eventDate);
165   const trimmedLocation = (event?.location ?? "").trim();
166   const hasLocation = trimmedLocation.length > 0;
167 
168   const googleMapsUrl = hasLocation
169     ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
170         trimmedLocation,
171       )}`
172     : null;
173 
174   const wazeUrl = hasLocation
175     ? `https://waze.com/ul?q=${encodeURIComponent(
176         trimmedLocation,
177       )}&navigate=yes`
178     : null;
179 
180   const isPrePaid = event?.type === "PRE_PAGO";
181 
182   const checkoutSlug =
183     event?.inviteSlug?.trim() ||
184     effectiveSlug ||
185     (event?.id ? event.id : "");
186 
187   const hasCheckout = isPrePaid && checkoutSlug;
188 
189   return (
190     <div className="min-h-screen bg-slate-950 text-slate-50">
191       <div className="max-w-2xl mx-auto px-4 py-10 flex flex-col gap-8">
192         <header className="space-y-2">
193           <p className="text-[11px] font-semibold uppercase tracking-[0.2em] text-emerald-400">
194             Confirmação de presença
195           </p>
196 
197           <h1 className="text-2xl sm:text-3xl font-semibold text-slate-50">
198             {event?.name ?? "Convite para evento"}
199           </h1>
200 
201           <p className="text-sm text-slate-400 max-w-xl">
202             Confira os detalhes do evento e, em seguida, confirme sua presença
203             preenchendo seu nome logo abaixo.
204           </p>
205         </header>
206 
207         <section className="space-y-3 text-sm">
208           <h2 className="text-sm font-semibold text-slate-200">
209             Detalhes do evento
210           </h2>
211 
212           <div className="rounded-2xl border border-slate-800 bg-slate-900/40 p-4 space-y-2">
213             {loadingEvent && (
214               <p className="text-xs text-slate-400">
215                 Carregando informações do evento...
216               </p>
217             )}
218 
219             {!loadingEvent && eventError && (
220               <p className="text-xs text-red-400">{eventError}</p>
221             )}
222 
223             {!loadingEvent && !eventError && event && (
224               <div className="space-y-1 text-xs sm:text-sm text-slate-300">
225                 <p>
226                   <span className="font-semibold text-slate-100">Evento:</span>{" "}
227                   {event.name}
228                 </p>
229 
230                 {formattedDate && (
231                   <p>
232                     <span className="font-semibold text-slate-100">Data:</span>{" "}
233                     {formattedDate}
234                   </p>
235                 )}
236 
237                 {event.location && (
238                   <p>
239                     <span className="font-semibold text-slate-100">
240                       Local:
241                     </span>{" "}
242                     {event.location}
243                   </p>
244                 )}
245 
246                 <p>
247                   <span className="font-semibold text-slate-100">Tipo:</span>{" "}
248                   {event.type === "FREE"
249                     ? "Evento gratuito"
250                     : event.type === "PRE_PAGO"
251                     ? "Evento pré-pago"
252                     : "Evento pós-pago"}
253                 </p>
254 
255                 {event.description && (
256                   <p className="pt-1">
257                     <span className="font-semibold text-slate-100">
258                       Descrição:
259                     </span>{" "}
260                     {event.description}
261                   </p>
262                 )}
263 
264                 {isPrePaid && event.ticketPrice && (
265                   <p className="pt-1">
266                     <span className="font-semibold text-slate-100">
267                       Valor do ingresso:
268                     </span>{" "}
269                     {event.ticketPrice}
270                   </p>
271                 )}
272 
273                 {hasCheckout && (
274                   <div className="pt-3 space-y-1">
275                     <p className="text-[11px] text-slate-400">
276                       Para garantir sua participação, clique em{" "}
277                       <span className="font-semibold text-slate-100">
278                         Comprar ingresso
279                       </span>{" "}
280                       para fazer o pagamento online. Você precisará criar uma
281                       conta ou fazer login antes de pagar.
282                     </p>
283                     <a
284                       href={`/checkout/${encodeURIComponent(checkoutSlug)}`}
285                       className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-3 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-emerald-500"
286                     >
287                       Comprar ingresso
288                     </a>
289                   </div>
290                 )}
291               </div>
292             )}
293 
294             {!loadingEvent && !eventError && !event && (
295               <p className="text-xs text-slate-400">
296                 Não foi possível carregar informações do evento.
297               </p>
298             )}
299           </div>
300         </section>
301 
302         {hasLocation && (
303           <section className="space-y-3 text-sm">
304             <h2 className="text-sm font-semibold text-slate-200">
305               Como chegar
306             </h2>
307             <div className="rounded-2xl border border-slate-800 bg-slate-900/40 p-4 space-y-2">
308               <p className="text-[11px] text-slate-400">
309                 Use os atalhos abaixo para abrir o endereço no seu aplicativo de
310                 mapas preferido.
311               </p>
312               <div className="flex flex-wrap gap-2 mt-1">
313                 {googleMapsUrl && (
314                   <a
315                     href={googleMapsUrl}
316                     target="_blank"
317                     rel="noopener noreferrer"
318                     className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
319                   >
320                     Abrir no Google Maps
321                   </a>
322                 )}
323                 {wazeUrl && (
324                   <a
325                     href={wazeUrl}
326                     target="_blank"
327                     rel="noopener noreferrer"
328                     className="inline-flex items-center justify-center rounded-lg border border-slate-600 px-3 py-1.5 text-[11px] font-semibold text-slate-100 hover:bg-slate-800/80"
329                   >
330                     Abrir no Waze
331                   </a>
332                 )}
333               </div>
334             </div>
335           </section>
336         )}
337 
338         <section className="space-y-3">
339           <h2 className="text-sm font-semibold text-slate-200">
340             Confirmar presença
341           </h2>
342 
343           <form onSubmit={handleSubmit} className="flex flex-col gap-3">
344             <div className="flex flex-col gap-1">
345               <label className="text-xs font-medium text-slate-300">
346                 Seu nome completo
347               </label>
348               <input
349                 type="text"
350                 value={name}
351                 onChange={(e) => setName(e.target.value)}
352                 className="rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500"
353                 placeholder="Digite seu nome para confirmar presença"
354                 disabled={confirming || loadingEvent || !!eventError}
355               />
356             </div>
357 
358             {formError && (
359               <p className="text-[11px] text-red-400">{formError}</p>
360             )}
361 
362             <button
363               type="submit"
364               disabled={confirming || loadingEvent || !!eventError}
365               className="mt-1 inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 disabled:opacity-60"
366             >
367               {confirming ? "Confirmando..." : "Confirmar presença"}
368             </button>
369           </form>
370 
371           {confirmedName && (
372             <div className="mt-2 rounded-lg border border-emerald-700 bg-emerald-900/20 px-3 py-2">
373               <p className="text-xs text-emerald-300">
374                 Presença confirmada para{" "}
375                 <span className="font-semibold">{confirmedName}</span>.
376               </p>
377               <p className="mt-1 text-[10px] text-emerald-200/80">
378                 Esta confirmação já foi registrada na lista de confirmados do
379                 evento.
380               </p>
381             </div>
382           )}
383         </section>
384 
385         <footer className="pt-4 border-t border-slate-900 text-[11px] text-slate-500 flex flex-wrap items-center justify-between gap-2">
386           <span className="break-all">
387             Código do convite:{" "}
388             <span className="text-slate-300">
389               {effectiveSlug || "(não informado)"}
390             </span>
391           </span>
392 
393           {confirmedName && (
394             <span className="text-emerald-300">
395               Obrigado por confirmar sua presença ✨
396             </span>
397           )}
398         </footer>
399       </div>
400     </div>
401   );
402 }

===== app/(app)/ingressos/page.tsx =====
1 import IngressosClient from "./IngressosClient";
2 
3 export default function IngressosPage() {
4   return <IngressosClient />;
5 }

===== app/(app)/ingressos/IngressosClient.tsx =====
1 "use client";
2 
3 import { useEffect, useState } from "react";
4 import { useRouter } from "next/navigation";
5 
6 type EventType = "PRE_PAGO" | "POS_PAGO" | "FREE";
7 
8 type TicketEvent = {
9   id: string;
10   name: string;
11   eventDate: string | null;
12   location: string | null;
13   type: EventType;
14 };
15 
16 type Ticket = {
17   id: string;
18   status: "ACTIVE" | "CANCELLED";
19   createdAt: string;
20   event: TicketEvent;
21 };
22 
23 function formatDate(iso: string | null) {
24   if (!iso) return null;
25   const d = new Date(iso);
26   if (Number.isNaN(d.getTime())) return null;
27 
28   const dia = String(d.getDate()).padStart(2, "0");
29   const mes = String(d.getMonth() + 1).padStart(2, "0");
30   const ano = d.getFullYear();
31   return `${dia}/${mes}/${ano}`;
32 }
33 
34 export default function IngressosClient() {
35   const router = useRouter();
36   const [tickets, setTickets] = useState<Ticket[]>([]);
37   const [loading, setLoading] = useState(true);
38   const [error, setError] = useState<string | null>(null);
39 
40   useEffect(() => {
41     let active = true;
42 
43     async function loadTickets() {
44       try {
45         setLoading(true);
46         setError(null);
47 
48         const res = await fetch("/api/tickets", { cache: "no-store" });
49 
50         if (res.status === 401) {
51           const next = encodeURIComponent("/ingressos");
52           router.push(`/login?next=${next}`);
53           return;
54         }
55 
56         if (!res.ok) {
57           const data = await res.json().catch(() => null);
58           setError(
59             data?.error ?? "Erro ao carregar seus ingressos.",
60           );
61           return;
62         }
63 
64         const data = (await res.json()) as Ticket[];
65         if (!active) return;
66         setTickets(data);
67       } catch (err) {
68         console.error(err);
69         if (!active) return;
70         setError("Erro inesperado ao carregar seus ingressos.");
71       } finally {
72         if (!active) return;
73         setLoading(false);
74       }
75     }
76 
77     void loadTickets();
78 
79     return () => {
80       active = false;
81     };
82   }, [router]);
83 
84   return (
85     <div className="min-h-screen bg-slate-950 text-slate-50 flex flex-col">
86       <header className="flex items-center justify-between px-6 py-4 border-b border-slate-800">
87         <h1 className="text-lg sm:text-xl font-semibold">
88           Meus ingressos
89         </h1>
90         <button
91           type="button"
92           onClick={() => router.push("/dashboard")}
93           className="text-xs font-medium text-slate-300 hover:text-slate-100"
94         >
95           Voltar para eventos
96         </button>
97       </header>
98 
99       <main className="flex-1 px-4 py-6 sm:px-6 lg:px-8 max-w-4xl w-full mx-auto flex flex-col gap-4">
100         {loading && (
101           <p className="text-sm text-slate-300">Carregando ingressos...</p>
102         )}
103 
104         {error && (
105           <p className="text-sm text-red-400">
106             {error}
107           </p>
108         )}
109 
110         {!loading && !error && tickets.length === 0 && (
111           <p className="text-sm text-slate-400">
112             Você ainda não possui ingressos. Quando fizer uma compra, eles
113             aparecerão aqui.
114           </p>
115         )}
116 
117         {!loading && tickets.length > 0 && (
118           <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
119             {tickets.map((ticket) => {
120               const event = ticket.event;
121               const dateLabel = formatDate(event.eventDate);
122               const statusLabel =
123                 ticket.status === "ACTIVE" ? "Ativo" : "Cancelado";
124               const isActive = ticket.status === "ACTIVE";
125 
126               return (
127                 <div
128                   key={ticket.id}
129                   className="flex flex-col gap-2 rounded-2xl border border-slate-800 bg-slate-900/60 p-4"
130                 >
131                   <div className="flex items-center justify-between gap-2">
132                     <span className="text-[11px] uppercase tracking-wide text-slate-400">
133                       {event.type === "FREE"
134                         ? "Evento gratuito"
135                         : event.type === "PRE_PAGO"
136                         ? "Evento pré-pago"
137                         : "Evento pós-pago"}
138                     </span>
139                     <span
140                       className={`inline-flex items-center rounded-full px-2.5 py-0.5 text-[10px] font-semibold ${
141                         isActive
142                           ? "bg-emerald-900/40 text-emerald-300 border border-emerald-600/60"
143                           : "bg-slate-900/60 text-slate-400 border border-slate-700/80"
144                       }`}
145                     >
146                       {statusLabel}
147                     </span>
148                   </div>
149 
150                   <h2 className="text-sm font-semibold text-slate-50 line-clamp-2">
151                     {event.name}
152                   </h2>
153 
154                   {dateLabel && (
155                     <p className="text-xs text-slate-300">
156                       <span className="font-medium text-slate-200">
157                         Data:
158                       </span>{" "}
159                       {dateLabel}
160                     </p>
161                   )}
162 
163                   {event.location && (
164                     <p className="text-xs text-slate-300 line-clamp-2">
165                       <span className="font-medium text-slate-200">
166                         Local:
167                       </span>{" "}
168                       {event.location}
169                   </p>
170                   )}
171 
172                   <p className="mt-2 text-[11px] text-slate-500">
173                     Ingresso gerado em{" "}
174                     {formatDate(ticket.createdAt) ?? "data desconhecida"}.
175                   </p>
176                 </div>
177               );
178             })}
179           </div>
180         )}
181       </main>
182     </div>
183   );
184 }
